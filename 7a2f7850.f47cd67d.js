(window.webpackJsonp=window.webpackJsonp||[]).push([[248],{305:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return b})),n.d(t,"metadata",(function(){return l})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return p}));var a=n(2),r=n(6),c=(n(0),n(561)),o=n(565),i=n(566),b={id:"3.sampleCode",title:"\u6848\u4f8b\u4ee3\u7801\u5b9e\u73b0",hide_title:!0},l={unversionedId:"springcloudalibaba/\u5206\u5e03\u5f0f\u4e8b\u52a1/3.sampleCode",id:"springcloudalibaba/\u5206\u5e03\u5f0f\u4e8b\u52a1/3.sampleCode",isDocsHomePage:!1,title:"\u6848\u4f8b\u4ee3\u7801\u5b9e\u73b0",description:"\u6848\u4f8b\u4ee3\u7801\u5b9e\u73b0",source:"@site/docs/springcloudalibaba/\u5206\u5e03\u5f0f\u4e8b\u52a1/3.\u6848\u4f8b\u4ee3\u7801\u5b9e\u73b0.md",slug:"/springcloudalibaba/\u5206\u5e03\u5f0f\u4e8b\u52a1/3.sampleCode",permalink:"/docs/springcloudalibaba/\u5206\u5e03\u5f0f\u4e8b\u52a1/3.sampleCode",version:"current",sidebar:"someSidebar",previous:{title:"\u6848\u4f8b\u6570\u636e\u5e93",permalink:"/docs/springcloudalibaba/\u5206\u5e03\u5f0f\u4e8b\u52a1/2.sampleDatabase"},next:{title:"Docker\u6982\u8ff0",permalink:"/docs/docker/1.docker"}},s=[{value:"\u6848\u4f8b\u4ee3\u7801\u5b9e\u73b0",id:"\u6848\u4f8b\u4ee3\u7801\u5b9e\u73b0",children:[]},{value:"Order-Module",id:"order-module",children:[]},{value:"Storage-Module",id:"storage-module",children:[]},{value:"Account-Module",id:"account-module",children:[]},{value:"\u4f7f\u7528",id:"\u4f7f\u7528",children:[{value:"\u6b63\u5e38\u4e0b\u5355",id:"\u6b63\u5e38\u4e0b\u5355",children:[]},{value:"@GlobalTransactional \u6ce8\u89e3",id:"globaltransactional-\u6ce8\u89e3",children:[{value:"\u8d85\u65f6\u5f02\u5e38 + \u6ca1\u52a0 @GlobalTransactional",id:"\u8d85\u65f6\u5f02\u5e38--\u6ca1\u52a0-globaltransactional",children:[]},{value:"\u8d85\u65f6\u5f02\u5e38 + \u6dfb\u52a0 @GlobalTransacitonal",id:"\u8d85\u65f6\u5f02\u5e38--\u6dfb\u52a0-globaltransacitonal",children:[]}]}]}],d={rightToc:s};function p(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(c.b)("wrapper",Object(a.a)({},d,n,{components:t,mdxType:"MDXLayout"}),Object(c.b)("h1",{id:"\u6848\u4f8b\u4ee3\u7801\u5b9e\u73b0"},"\u6848\u4f8b\u4ee3\u7801\u5b9e\u73b0"),Object(c.b)("blockquote",null,Object(c.b)("h2",Object(a.a)({parentName:"blockquote"},{id:"\u4e09\u4e2a\u5fae\u670d\u52a1"}),"\u4e09\u4e2a\u5fae\u670d\u52a1"),Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("strong",{parentName:"li"},"Order-Module\uff1a"),Object(c.b)("inlineCode",{parentName:"li"},"seata-order-service2001")," \u8ba2\u5355\u6a21\u5757"),Object(c.b)("li",{parentName:"ul"},Object(c.b)("strong",{parentName:"li"},"Storage-Module\uff1a")," ",Object(c.b)("inlineCode",{parentName:"li"},"seata-storage-service2002")," \u5e93\u5b58\u6a21\u5757"),Object(c.b)("li",{parentName:"ul"},Object(c.b)("strong",{parentName:"li"},"Account-Module\uff1a")," ",Object(c.b)("inlineCode",{parentName:"li"},"seata-account-service2003")," \u8d26\u6237\u6a21\u5757"))),Object(c.b)("h1",{id:"order-module"},"Order-Module"),Object(c.b)("blockquote",null,Object(c.b)("h1",Object(a.a)({parentName:"blockquote"},{id:"seata-order-service2001"}),"seata-order-service2001"),Object(c.b)(o.a,{defaultValue:"1",values:[{label:"POM",value:"1"},{label:"YAML",value:"2"},{label:"\u4e3b\u542f\u52a8",value:"3"},{label:"\u5b9e\u4f53\u7c7b",value:"4"},{label:"file.conf",value:"5"},{label:"registry.conf",value:"6"},{label:"\u4e1a\u52a1\u7c7b",value:"7"},{label:"\u914d\u7f6e\u7c7b",value:"8"}],mdxType:"Tabs"},Object(c.b)(i.a,{value:"1",mdxType:"TabItem"},Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-xml"}),"<dependencies>\n\x3c!-- nacos --\x3e\n<dependency>\n<groupId>com.alibaba.cloud</groupId>\n<artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\n</dependency>\n\x3c!-- seata--\x3e\n<dependency>\n<groupId>com.alibaba.cloud</groupId>\n<artifactId>spring-cloud-starter-alibaba-seata</artifactId>\n<exclusions>\n<exclusion>\n    <groupId>io.seata</groupId>\n    <artifactId>seata-all</artifactId>\n</exclusion>\n</exclusions>\n</dependency>\n<dependency>\n<groupId>io.seata</groupId>\n<artifactId>seata-all</artifactId>\n<version>0.9.0</version>\n</dependency>\n<dependency>\n<groupId>org.springframework.cloud</groupId>\n<artifactId>spring-cloud-starter-openfeign</artifactId>\n</dependency>\n<dependency>\n<groupId>org.springframework.boot</groupId>\n<artifactId>spring-boot-starter-web</artifactId>\n</dependency>\n<dependency>\n<groupId>org.mybatis.spring.boot</groupId>\n<artifactId>mybatis-spring-boot-starter</artifactId>\n</dependency>\n<dependency>\n<groupId>com.alibaba</groupId>\n<artifactId>druid</artifactId>\n</dependency>\n<dependency>\n<groupId>mysql</groupId>\n<artifactId>mysql-connector-java</artifactId>\n</dependency>\n\x3c!--jdbc--\x3e\n<dependency>\n<groupId>org.springframework.boot</groupId>\n<artifactId>spring-boot-starter-jdbc</artifactId>\n</dependency>\n<dependency>\n<groupId>org.springframework.boot</groupId>\n<artifactId>spring-boot-starter-actuator</artifactId>\n</dependency>\n<dependency>\n<groupId>org.projectlombok</groupId>\n<artifactId>lombok</artifactId>\n<optional>true</optional>\n</dependency>\n<dependency>\n<groupId>org.springframework.boot</groupId>\n<artifactId>spring-boot-starter-test</artifactId>\n<scope>test</scope>\n</dependency>\n\x3c!--hutool \u6d4b\u8bd5\u96ea\u82b1\u7b97\u6cd5--\x3e\n<dependency>\n<groupId>cn.hutool</groupId>\n<artifactId>hutool-captcha</artifactId>\n<version>5.2.0</version>\n</dependency>\n\x3c!-- https://mvnrepository.com/artifact/com.google.errorprone/error_prone_core --\x3e\n\x3c!--<dependency>\n<groupId>com.google.errorprone</groupId>\n<artifactId>error_prone_core</artifactId>\n<version>0.92</version>\n</dependency>--\x3e\n</dependencies>\n"))),Object(c.b)(i.a,{value:"2",mdxType:"TabItem"},Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),"server:\n  port: 2001\n\nspring:\n  application:\n    name: seata-order-service\n  cloud:\n    alibaba:\n      seata:\n        # \u81ea\u5b9a\u4e49\u4e8b\u52a1\u7ec4\u540d\u79f0\u9700\u8981\u4e0eseata-server\u4e2d\u7684\u5bf9\u5e94\n        tx-service-group: bsx_group\n    nacos:\n      discovery:\n        server-addr: 127.0.0.1:8848\n  datasource:\n    # \u5f53\u524d\u6570\u636e\u6e90\u64cd\u4f5c\u7c7b\u578b\n    type: com.alibaba.druid.pool.DruidDataSource\n    # mysql\u9a71\u52a8\u7c7b\n    driver-class-name: com.mysql.jdbc.Driver\n    url: jdbc:mysql://localhost:3306/seata_order?serverTimezone=UTC&useUnicode=true&characterEncoding=utf-8\n    username: root\n    password: root\nfeign:\n  hystrix:\n    enabled: false\nlogging:\n  level:\n    io:\n      seata: info\n\nmybatis:\n  mapperLocations: classpath:mapper/*.xml\n"))),Object(c.b)(i.a,{value:"3",mdxType:"TabItem"},Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},"\u53d6\u6d88\u6570\u636e\u6e90\u81ea\u52a8\u521b\u5efa\uff0c\u56e0\u4e3a\u540e\u7eed\u4f1a\u914d\u7f6e\u6570\u636e\u6e90\u4ee3\u7406")),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),"@SpringBootApplication(exclude = DataSourceAutoConfiguration.class) //\u53d6\u6d88\u6570\u636e\u6e90\u7684\u81ea\u52a8\u521b\u5efa\n@EnableDiscoveryClient\n@EnableFeignClients\npublic class SeataOrderMain2001 {\n\n    public static void main(String[] args) {\n    SpringApplication.run(SeataOrderMain2001.class, args);\n    }\n}\n"))),Object(c.b)(i.a,{value:"4",mdxType:"TabItem"},Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java",metastring:'title="domain.CommonResult"',title:'"domain.CommonResult"'}),"@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class CommonResult<T> {\n    private Integer code;\n    private String message;\n    private T data;\n\n    public CommonResult(Integer code, String message) {\n        this(code, message, null);\n    }\n}\n")),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java",metastring:'title="domain.Order"',title:'"domain.Order"'}),"@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class Order {\n\nprivate Long id;\n\nprivate Long userId;\n\nprivate Long productId;\n\nprivate Integer count;\n\nprivate BigDecimal money;\n\nprivate Integer status; // \u8ba2\u5355\u72b6\u6001 0\uff1a\u521b\u5efa\u4e2d 1\uff1a\u5df2\u5b8c\u7ed3\n}\n"))),Object(c.b)(i.a,{value:"5",mdxType:"TabItem"},Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("strong",{parentName:"li"},"\u5728\u5fae\u670d\u52a1 ",Object(c.b)("inlineCode",{parentName:"strong"},"resource")," \u8def\u5f84\u4e0b\u521b\u5efa ",Object(c.b)("inlineCode",{parentName:"strong"},"file.conf"))," ")),Object(c.b)("div",Object(a.a)({parentName:"blockquote"},{className:"admonition admonition-warning alert alert--danger"}),Object(c.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(c.b)("h5",{parentName:"div"},Object(c.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(c.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(c.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"})))),"\u5927\u5751")),Object(c.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(c.b)("ul",{parentName:"div"},Object(c.b)("li",{parentName:"ul"},"\u5728 seata \u5b89\u88c5\u76ee\u5f55 ",Object(c.b)("inlineCode",{parentName:"li"},"/conf/file.conf")," \u6587\u4ef6\u4e2d\uff0c\u6709\u4e00\u4e2a ",Object(c.b)("inlineCode",{parentName:"li"},'service.vgroup_mapping.my_test_tx_group = "bsx_group"'),"\uff0c\u6b64\u5904\u6211\u8bbe\u7f6e\u4e3a\u4e86 ",Object(c.b)("inlineCode",{parentName:"li"},"bsx_group")),Object(c.b)("li",{parentName:"ul"},"\u5728\u4e09\u4e2a\u5fae\u670d\u52a1\u7684 ",Object(c.b)("inlineCode",{parentName:"li"},"resource/file.conf")," \u4e2d\uff0c\u8981\u6539\u5199\u4e3a ",Object(c.b)("inlineCode",{parentName:"li"},'service.vgroup_mapping.bsx_group = "default"'),Object(c.b)("ul",{parentName:"li"},Object(c.b)("li",{parentName:"ul"},"service.vgroup.mapping. \u4e4b\u540e\u63a5\u4e0a seata \u8def\u5f84\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7684 ",Object(c.b)("inlineCode",{parentName:"li"},"bsx_group")),Object(c.b)("li",{parentName:"ul"},"\u503c ",Object(c.b)("inlineCode",{parentName:"li"},"default")," \u968f\u4fbf\uff0c\u5efa\u8bae\u5c31\u5199 ",Object(c.b)("inlineCode",{parentName:"li"},"default"))))))),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python",metastring:"{31}","{31}":!0}),'transport {\n  # tcp udt unix-domain-socket\n  type = "TCP"\n  #NIO NATIVE\n  server = "NIO"\n  #enable heartbeat\n  heartbeat = true\n  #thread factory for netty\n  thread-factory {\n    boss-thread-prefix = "NettyBoss"\n    worker-thread-prefix = "NettyServerNIOWorker"\n    server-executor-thread-prefix = "NettyServerBizHandler"\n    share-boss-worker = false\n    client-selector-thread-prefix = "NettyClientSelector"\n    client-selector-thread-size = 1\n    client-worker-thread-prefix = "NettyClientWorkerThread"\n    # netty boss thread size,will not be used for UDT\n    boss-thread-size = 1\n    #auto default pin or 8\n    worker-thread-size = 8\n  }\n  shutdown {\n    # when destroy server, wait seconds\n    wait = 3\n  }\n  serialization = "seata"\n  compressor = "none"\n}\nservice {\n  #vgroup->rgroup\n  vgroup_mapping.bsx_group = "default"\n  #only support single node\n  default.grouplist = "127.0.0.1:8091"\n  #degrade current not support\n  enableDegrade = false\n  #disable\n  disable = false\n  #unit ms,s,m,h,d represents milliseconds, seconds, minutes, hours, days, default permanent\n  max.commit.retry.timeout = "-1"\n  max.rollback.retry.timeout = "-1"\n}\n\nclient {\n  async.commit.buffer.limit = 10000\n  lock {\n    retry.internal = 10\n    retry.times = 30\n  }\n  report.retry.count = 5\n  tm.commit.retry.count = 1\n  tm.rollback.retry.count = 1\n}\n\n## transaction log store\nstore {\n  ## store mode: file\u3001db\n  # mode = "file"\n  mode = "db" # \u4fee\u6539\u4e3a\u4f7f\u7528\u6570\u636e\u5e93\u5b58\u50a8\n\n  ## file store\n  file {\n    dir = "sessionStore"\n\n    # branch session size , if exceeded first try compress lockkey, still exceeded throws exceptions\n    max-branch-session-size = 16384\n    # globe session size , if exceeded throws exceptions\n    max-global-session-size = 512\n    # file buffer size , if exceeded allocate new buffer\n    file-write-buffer-cache-size = 16384\n    # when recover batch read size\n    session.reload.read_size = 100\n    # async, sync\n    flush-disk-mode = async\n  }\n\n  ## database store\n  db {\n    ## the implement of javax.sql.DataSource, such as DruidDataSource(druid)/BasicDataSource(dbcp) etc.\n    datasource = "dbcp"\n    ## mysql/oracle/h2/oceanbase etc.\n    db-type = "mysql"\n    driver-class-name = "com.mysql.jdbc.Driver"\n    url = "jdbc:mysql://127.0.0.1:3306/seata"\n    user = "root"\n    password = "root"\n    min-conn = 1\n    max-conn = 3\n    global.table = "global_table"\n    branch.table = "branch_table"\n    lock-table = "lock_table"\n    query-limit = 100\n  }\n}\nlock {\n  ## the lock store mode: local\u3001remote\n  mode = "remote"\n\n  local {\n    ## store locks in user\'s database\n  }\n\n  remote {\n    ## store locks in the seata\'s server\n  }\n}\nrecovery {\n  #schedule committing retry period in milliseconds\n  committing-retry-period = 1000\n  #schedule asyn committing retry period in milliseconds\n  asyn-committing-retry-period = 1000\n  #schedule rollbacking retry period in milliseconds\n  rollbacking-retry-period = 1000\n  #schedule timeout retry period in milliseconds\n  timeout-retry-period = 1000\n}\n\ntransaction {\n  undo.data.validation = true\n  undo.log.serialization = "jackson"\n  undo.log.save.days = 7\n  #schedule delete expired undo_log in milliseconds\n  undo.log.delete.period = 86400000\n  undo.log.table = "undo_log"\n}\n\n## metrics settings\nmetrics {\n  enabled = false\n  registry-type = "compact"\n  # multi exporters use comma divided\n  exporter-list = "prometheus"\n  exporter-prometheus-port = 9898\n}\n\nsupport {\n  ## spring\n  spring {\n    # auto proxy the DataSource bean\n    datasource.autoproxy = false\n  }\n}\n'))),Object(c.b)(i.a,{value:"6",mdxType:"TabItem"},Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("strong",{parentName:"li"},"\u5728\u5fae\u670d\u52a1 ",Object(c.b)("inlineCode",{parentName:"strong"},"resource")," \u8def\u5f84\u4e0b\u521b\u5efa ",Object(c.b)("inlineCode",{parentName:"strong"},"registry.conf"))," \u4f9d\u7167 seata-server \u5b89\u88c5\u65f6\u4fee\u6539\u7684\u5185\u5bb9\u586b\u5199")),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),'registry {\n  # file \u3001nacos \u3001eureka\u3001redis\u3001zk\u3001consul\u3001etcd3\u3001sofa\n  # type = "file"\n  type = "nacos" # \u4fee\u6539\u4e3a nacos\n\n  nacos {\n    serverAddr = "localhost:8848"\n    namespace = ""\n    cluster = "default"\n  }\n  eureka {\n    serviceUrl = "http://localhost:8761/eureka"\n    application = "default"\n    weight = "1"\n  }\n  redis {\n    serverAddr = "localhost:6379"\n    db = "0"\n  }\n  zk {\n    cluster = "default"\n    serverAddr = "127.0.0.1:2181"\n    session.timeout = 6000\n    connect.timeout = 2000\n  }\n  consul {\n    cluster = "default"\n    serverAddr = "127.0.0.1:8500"\n  }\n  etcd3 {\n    cluster = "default"\n    serverAddr = "http://localhost:2379"\n  }\n  sofa {\n    serverAddr = "127.0.0.1:9603"\n    application = "default"\n    region = "DEFAULT_ZONE"\n    datacenter = "DefaultDataCenter"\n    cluster = "default"\n    group = "SEATA_GROUP"\n    addressWaitTime = "3000"\n  }\n  file {\n    name = "file.conf"\n  }\n}\n\nconfig {\n  # file\u3001nacos \u3001apollo\u3001zk\u3001consul\u3001etcd3\n  type = "file"\n\n  nacos {\n    serverAddr = "localhost"\n    namespace = ""\n  }\n  consul {\n    serverAddr = "127.0.0.1:8500"\n  }\n  apollo {\n    app.id = "seata-server"\n    apollo.meta = "http://192.168.1.204:8801"\n  }\n  zk {\n    serverAddr = "127.0.0.1:2181"\n    session.timeout = 6000\n    connect.timeout = 2000\n  }\n  etcd3 {\n    serverAddr = "http://localhost:2379"\n  }\n  file {\n    name = "file.conf"\n  }\n}\n'))),Object(c.b)(i.a,{value:"7",mdxType:"TabItem"},Object(c.b)("h2",Object(a.a)({parentName:"blockquote"},{id:"dao-mapper"}),"Dao (Mapper)"),Object(c.b)("h3",Object(a.a)({parentName:"blockquote"},{id:"\u63a5\u53e3"}),"\u63a5\u53e3"),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java",metastring:'title="dao.OrderDao"',title:'"dao.OrderDao"'}),'@Mapper\npublic interface OrderDao {\n    /**\n     * 1 \u65b0\u5efa\u8ba2\u5355\n     *\n     * @param order\n     * @return\n     */\n    int create(Order order);\n\n    /**\n     * 2 \u4fee\u6539\u8ba2\u5355\u72b6\u6001,\u4ece0\u6539\u4e3a1\n     *\n     * @param userId\n     * @param status\n     * @return\n     */\n    int update(@Param("userId") Long userId, @Param("status") Integer status);\n}\n')),Object(c.b)("h3",Object(a.a)({parentName:"blockquote"},{id:"ordermapperxml"}),"OrderMapper.xml"),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-xml"}),'<?xml version="1.0" encoding="UTF-8" ?>\n<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"\n        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">\n<mapper namespace="com.bsx.springcloud.dao.OrderDao">\n\n    <resultMap id="BaseResultMap" type="com.bsx.springcloud.domain.Order">\n        <id column="id" property="id" jdbcType="BIGINT"></id>\n        <result column="user_id" property="userId" jdbcType="BIGINT"></result>\n        <result column="product_id" property="productId" jdbcType="BIGINT"></result>\n        <result column="count" property="count" jdbcType="INTEGER"></result>\n        <result column="money" property="money" jdbcType="DECIMAL"></result>\n        <result column="status" property="status" jdbcType="INTEGER"></result>\n    </resultMap>\n\n    <insert id="create" parameterType="com.bsx.springcloud.domain.Order" useGeneratedKeys="true"\n            keyProperty="id">\n        insert into t_order(user_id,product_id,count,money,status) values (#{userId},#{productId},#{count},#{money},0);\n    </insert>\n\n    <update id="update">\n        update t_order set status =1 where user_id =#{userId} and status=#{status};\n    </update>\n</mapper>\n')),Object(c.b)("h2",Object(a.a)({parentName:"blockquote"},{id:"service"}),"Service"),Object(c.b)("h3",Object(a.a)({parentName:"blockquote"},{id:"orderservice"}),"OrderService"),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),"public interface OrderService {\n\n    /**\n     * \u521b\u5efa\u8ba2\u5355\n     * @param order\n     */\n    void create(Order order);\n}\n")),Object(c.b)("h4",Object(a.a)({parentName:"blockquote"},{id:"impl"}),"impl"),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),'@Service\n@Slf4j\npublic class OrderServiceImpl implements OrderService {\n\n    @Resource\n    private OrderDao orderDao;\n    @Resource\n    private AccountService accountService;\n    @Resource\n    private StorageService storageService;\n\n    /**\n     * \u521b\u5efa\u8ba2\u5355->\u8c03\u7528\u5e93\u5b58\u670d\u52a1\u6263\u51cf\u5e93\u5b58->\u8c03\u7528\u8d26\u6237\u670d\u52a1\u6263\u51cf\u8d26\u6237\u4f59\u989d->\u4fee\u6539\u8ba2\u5355\u72b6\u6001\n     * \u7b80\u5355\u8bf4:\n     * \u4e0b\u8ba2\u5355->\u51cf\u5e93\u5b58->\u51cf\u4f59\u989d->\u6539\u72b6\u6001\n     * GlobalTransactional seata\u5f00\u542f\u5206\u5e03\u5f0f\u4e8b\u52a1,\u5f02\u5e38\u65f6\u56de\u6eda,name\u4fdd\u8bc1\u552f\u4e00\u5373\u53ef\n     *\n     * @param order \u8ba2\u5355\u5bf9\u8c61\n     */\n    @Override\n//    @GlobalTransactional(name = "fsp-create-order", rollbackFor = Exception.class)\n    ///@GlobalTransactional(name = "fsp-create-order", rollbackFor = Exception.class)\n    public void create(Order order) {\n        // 1 \u65b0\u5efa\u8ba2\u5355\n        log.info("-----\x3e\u5f00\u59cb\u65b0\u5efa\u8ba2\u5355");\n        orderDao.create(order);\n\n        // 2 \u6263\u51cf\u5e93\u5b58\n        log.info("-----\x3e\u8ba2\u5355\u5fae\u670d\u52a1\u5f00\u59cb\u8c03\u7528\u5e93\u5b58,\u505a\u6263\u51cfCount");\n        storageService.decrease(order.getProductId(), order.getCount());\n        log.info("-----\x3e\u8ba2\u5355\u5fae\u670d\u52a1\u5f00\u59cb\u8c03\u7528\u5e93\u5b58,\u505a\u6263\u51cfEnd");\n\n        // 3 \u6263\u51cf\u8d26\u6237\n        log.info("-----\x3e\u8ba2\u5355\u5fae\u670d\u52a1\u5f00\u59cb\u8c03\u7528\u8d26\u6237,\u505a\u6263\u51cfMoney");\n        accountService.decrease(order.getUserId(), order.getMoney());\n        log.info("-----\x3e\u8ba2\u5355\u5fae\u670d\u52a1\u5f00\u59cb\u8c03\u7528\u8d26\u6237,\u505a\u6263\u51cfEnd");\n\n        // 4 \u4fee\u6539\u8ba2\u5355\u72b6\u6001,\u4ece0\u52301,1\u4ee3\u8868\u5df2\u5b8c\u6210\n        log.info("-----\x3e\u4fee\u6539\u8ba2\u5355\u72b6\u6001\u5f00\u59cb");\n        orderDao.update(order.getUserId(), 0);\n\n        log.info("-----\x3e\u4e0b\u8ba2\u5355\u7ed3\u675f\u4e86,O(\u2229_\u2229)O\u54c8\u54c8~");\n    }\n}\n')),Object(c.b)("h3",Object(a.a)({parentName:"blockquote"},{id:"accountservice"}),"AccountService"),Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},"OpenFegin \u8fdc\u7a0b\u8c03\u7528")),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),'@FeignClient(value = "seata-account-service")\npublic interface AccountService {\n\n    /**\n     * \u51cf\u4f59\u989d\n     * @param userId\n     * @param money\n     * @return\n     */\n    @PostMapping(value = "/account/decrease")\n    CommonResult decrease(@RequestParam("userId") Long userId, @RequestParam("money") BigDecimal money);\n}\n')),Object(c.b)("h3",Object(a.a)({parentName:"blockquote"},{id:"storageservice"}),"StorageService"),Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},"OpenFeign \u8fdc\u7a0b\u8c03\u7528")),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),'@FeignClient(value = "seata-storage-service")\npublic interface StorageService {\n\n    /**\n     * \u51cf\u5e93\u5b58\n     * @param productId\n     * @param count\n     * @return\n     */\n    @PostMapping(value = "/storage/decrease")\n    CommonResult decrease(@RequestParam("productId") Long productId, @RequestParam("count") Integer count);\n}\n')),Object(c.b)("h2",Object(a.a)({parentName:"blockquote"},{id:"controller"}),"Controller"),Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("strong",{parentName:"li"},"OrderController"))),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),'@RestController\npublic class OrderController {\n    @Resource\n    private OrderService orderService;\n\n    /**\n     * \u521b\u5efa\u8ba2\u5355\n     *\n     * @param order\n     * @return\n     */\n    @GetMapping("/order/create")\n    public CommonResult create(Order order) {\n        orderService.create(order);\n        return new CommonResult(200, "\u8ba2\u5355\u521b\u5efa\u6210\u529f");\n    }\n}\n'))),Object(c.b)(i.a,{value:"8",mdxType:"TabItem"},Object(c.b)("h2",Object(a.a)({parentName:"blockquote"},{id:"seata-mybatis-\u6574\u5408\u914d\u7f6e"}),"Seata Mybatis \u6574\u5408\u914d\u7f6e"),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java",metastring:'title="config.MyBatisConfig \u914d\u7f6e\u5305\u626b\u63cf"',title:'"config.MyBatisConfig','\u914d\u7f6e\u5305\u626b\u63cf"':!0}),'@Configuration\n@MapperScan({"com.bsx.springcloud.dao"})\npublic class MyBatisConfig {\n\n}\n')),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java",metastring:'title="config.DataSourceProxyConfig \u6570\u636e\u6e90\u4ee3\u7406"',title:'"config.DataSourceProxyConfig','\u6570\u636e\u6e90\u4ee3\u7406"':!0}),'/**\n * \u4f7f\u7528Seata\u5bf9\u6570\u636e\u6e90\u8fdb\u884c\u4ee3\u7406\n */\n@Configuration\npublic class DataSourceProxyConfig {\n\n    @Value("${mybatis.mapperLocations}")\n    private String mapperLocations;\n\n    @Bean\n    @ConfigurationProperties(prefix = "spring.datasource")\n    public DataSource druidDataSource() {\n        return new DruidDataSource();\n    }\n\n    @Bean\n    public DataSourceProxy dataSourceProxy(DataSource druidDataSource) {\n        return new DataSourceProxy(druidDataSource);\n    }\n\n    @Bean\n    public SqlSessionFactory sqlSessionFactoryBean(DataSourceProxy dataSourceProxy) throws Exception {\n        SqlSessionFactoryBean bean = new SqlSessionFactoryBean();\n        bean.setDataSource(dataSourceProxy);\n        ResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();\n        bean.setMapperLocations(resolver.getResources(mapperLocations));\n        return bean.getObject();\n    }\n}\n'))))),Object(c.b)("div",{className:"admonition admonition-info alert alert--info"},Object(c.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(c.b)("h5",{parentName:"div"},Object(c.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(c.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(c.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"\u63d0\u793a")),Object(c.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(c.b)("ul",{parentName:"div"},Object(c.b)("li",{parentName:"ul"},"\u5982\u679c\u540e\u7eed\u8c03\u7528\u62a5\u8d85\u65f6\u5f02\u5e38\uff0c\u90a3\u4e48\u53c2\u8003 OpenFeign \u7684\u53ea\u662f\uff0c\u4fee\u6539\u9ed8\u8ba4\u8d85\u65f6\u65f6\u95f4\u5373\u53ef",Object(c.b)("ul",{parentName:"li"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"feign.client.config.default.connect-timeout=300000")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"feign.client.config.default.read-timeout=300000")))),Object(c.b)("li",{parentName:"ul"},"\u63a7\u5236\u53f0 ",Object(c.b)("inlineCode",{parentName:"li"},"Netty")," \u6301\u7eed\u62a5\u9519\u5c5e\u4e8e\u6b63\u5e38\u60c5\u51b5\uff0c\u89c9\u5f97\u70e6\u53ef\u4ee5\u624b\u52a8\u5173\u95ed Netty \u65e5\u5fd7\u6253\u5370",Object(c.b)("ul",{parentName:"li"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"logging.level.io.seata.core.rpc.netty.NettyClientChannelManager=off"))))))),Object(c.b)("h1",{id:"storage-module"},"Storage-Module"),Object(c.b)("blockquote",null,Object(c.b)("h3",Object(a.a)({parentName:"blockquote"},{id:"seata-storage-service2002"}),"seata-storage-service2002"),Object(c.b)(o.a,{defaultValue:"1",values:[{label:"POM",value:"1"},{label:"YAML",value:"2"},{label:"\u4e3b\u542f\u52a8",value:"3"},{label:"\u5b9e\u4f53\u7c7b",value:"4"},{label:"file.conf",value:"5"},{label:"registry.conf",value:"6"},{label:"\u4e1a\u52a1\u7c7b",value:"7"},{label:"\u914d\u7f6e\u7c7b",value:"8"}],mdxType:"Tabs"},Object(c.b)(i.a,{value:"1",mdxType:"TabItem"},Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-xml"}),"<dependencies>\n\x3c!-- nacos --\x3e\n<dependency>\n<groupId>com.alibaba.cloud</groupId>\n<artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\n</dependency>\n\x3c!-- seata--\x3e\n<dependency>\n<groupId>com.alibaba.cloud</groupId>\n<artifactId>spring-cloud-starter-alibaba-seata</artifactId>\n<exclusions>\n<exclusion>\n    <groupId>io.seata</groupId>\n    <artifactId>seata-all</artifactId>\n</exclusion>\n</exclusions>\n</dependency>\n<dependency>\n<groupId>io.seata</groupId>\n<artifactId>seata-all</artifactId>\n<version>0.9.0</version>\n</dependency>\n<dependency>\n<groupId>org.springframework.cloud</groupId>\n<artifactId>spring-cloud-starter-openfeign</artifactId>\n</dependency>\n<dependency>\n<groupId>org.springframework.boot</groupId>\n<artifactId>spring-boot-starter-web</artifactId>\n</dependency>\n<dependency>\n<groupId>org.mybatis.spring.boot</groupId>\n<artifactId>mybatis-spring-boot-starter</artifactId>\n</dependency>\n<dependency>\n<groupId>com.alibaba</groupId>\n<artifactId>druid</artifactId>\n</dependency>\n<dependency>\n<groupId>mysql</groupId>\n<artifactId>mysql-connector-java</artifactId>\n</dependency>\n\x3c!--jdbc--\x3e\n<dependency>\n<groupId>org.springframework.boot</groupId>\n<artifactId>spring-boot-starter-jdbc</artifactId>\n</dependency>\n<dependency>\n<groupId>org.springframework.boot</groupId>\n<artifactId>spring-boot-starter-actuator</artifactId>\n</dependency>\n<dependency>\n<groupId>org.projectlombok</groupId>\n<artifactId>lombok</artifactId>\n<optional>true</optional>\n</dependency>\n<dependency>\n<groupId>org.springframework.boot</groupId>\n<artifactId>spring-boot-starter-test</artifactId>\n<scope>test</scope>\n</dependency>\n\x3c!--hutool \u6d4b\u8bd5\u96ea\u82b1\u7b97\u6cd5--\x3e\n<dependency>\n<groupId>cn.hutool</groupId>\n<artifactId>hutool-captcha</artifactId>\n<version>5.2.0</version>\n</dependency>\n\x3c!-- https://mvnrepository.com/artifact/com.google.errorprone/error_prone_core --\x3e\n\x3c!--<dependency>\n<groupId>com.google.errorprone</groupId>\n<artifactId>error_prone_core</artifactId>\n<version>0.92</version>\n</dependency>--\x3e\n</dependencies>\n"))),Object(c.b)(i.a,{value:"2",mdxType:"TabItem"},Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),"server:\n  port: 2002\n\nspring:\n  application:\n    name: seata-storage-service\n  cloud:\n    alibaba:\n      seata:\n        # \u81ea\u5b9a\u4e49\u4e8b\u52a1\u7ec4\u540d\u79f0\u9700\u8981\u4e0eseata-server\u4e2d\u7684\u5bf9\u5e94\n        tx-service-group: bsx_group\n    nacos:\n      discovery:\n        server-addr: 127.0.0.1:8848\n  datasource:\n    # \u5f53\u524d\u6570\u636e\u6e90\u64cd\u4f5c\u7c7b\u578b\n    type: com.alibaba.druid.pool.DruidDataSource\n    # mysql\u9a71\u52a8\u7c7b\n    driver-class-name: com.mysql.jdbc.Driver\n    url: jdbc:mysql://localhost:3306/seata_storage?serverTimezone=UTC&useUnicode=true&characterEncoding=utf-8\n    username: root\n    password: root\nfeign:\n  hystrix:\n    enabled: false\nlogging:\n  level:\n    io:\n      seata: info\n\nmybatis:\n  mapperLocations: classpath:mapper/*.xml\n"))),Object(c.b)(i.a,{value:"3",mdxType:"TabItem"},Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},"\u53d6\u6d88\u6570\u636e\u6e90\u81ea\u52a8\u521b\u5efa\uff0c\u56e0\u4e3a\u540e\u7eed\u4f1a\u914d\u7f6e\u6570\u636e\u6e90\u4ee3\u7406")),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),"@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)\n@EnableFeignClients\n@EnableDiscoveryClient\npublic class SeataStorageMain2002 {\n\n    public static void main(String[] args) {\n        SpringApplication.run(SeataStorageMain2002.class,args);\n    }\n}\n"))),Object(c.b)(i.a,{value:"4",mdxType:"TabItem"},Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java",metastring:'title="domain.CommonResult"',title:'"domain.CommonResult"'}),"@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class CommonResult<T> {\n    private Integer code;\n    private String message;\n    private T data;\n\n    public CommonResult(Integer code, String message) {\n        this(code, message, null);\n    }\n}\n")),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java",metastring:'title="domain.Storage"',title:'"domain.Storage"'}),"@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class Storage {\n\n    private Long id;\n\n    private Long productId;\n\n    private Integer total;\n\n    private Integer used;\n\n    private Integer residue;\n}\n"))),Object(c.b)(i.a,{value:"5",mdxType:"TabItem"},Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("strong",{parentName:"li"},"\u5728\u5fae\u670d\u52a1 ",Object(c.b)("inlineCode",{parentName:"strong"},"resource")," \u8def\u5f84\u4e0b\u521b\u5efa ",Object(c.b)("inlineCode",{parentName:"strong"},"file.conf"))," ")),Object(c.b)("div",Object(a.a)({parentName:"blockquote"},{className:"admonition admonition-warning alert alert--danger"}),Object(c.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(c.b)("h5",{parentName:"div"},Object(c.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(c.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(c.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"})))),"\u5927\u5751")),Object(c.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(c.b)("ul",{parentName:"div"},Object(c.b)("li",{parentName:"ul"},"\u5728 seata \u5b89\u88c5\u76ee\u5f55 ",Object(c.b)("inlineCode",{parentName:"li"},"/conf/file.conf")," \u6587\u4ef6\u4e2d\uff0c\u6709\u4e00\u4e2a ",Object(c.b)("inlineCode",{parentName:"li"},'service.vgroup_mapping.my_test_tx_group = "bsx_group"'),"\uff0c\u6b64\u5904\u6211\u8bbe\u7f6e\u4e3a\u4e86 ",Object(c.b)("inlineCode",{parentName:"li"},"bsx_group")),Object(c.b)("li",{parentName:"ul"},"\u5728\u4e09\u4e2a\u5fae\u670d\u52a1\u7684 ",Object(c.b)("inlineCode",{parentName:"li"},"resource/file.conf")," \u4e2d\uff0c\u8981\u6539\u5199\u4e3a ",Object(c.b)("inlineCode",{parentName:"li"},'service.vgroup_mapping.bsx_group = "default"'),Object(c.b)("ul",{parentName:"li"},Object(c.b)("li",{parentName:"ul"},"service.vgroup.mapping. \u4e4b\u540e\u63a5\u4e0a seata \u8def\u5f84\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7684 ",Object(c.b)("inlineCode",{parentName:"li"},"bsx_group")),Object(c.b)("li",{parentName:"ul"},"\u503c ",Object(c.b)("inlineCode",{parentName:"li"},"default")," \u968f\u4fbf\uff0c\u5efa\u8bae\u5c31\u5199 ",Object(c.b)("inlineCode",{parentName:"li"},"default"))))))),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),'transport {\n  # tcp udt unix-domain-socket\n  type = "TCP"\n  #NIO NATIVE\n  server = "NIO"\n  #enable heartbeat\n  heartbeat = true\n  #thread factory for netty\n  thread-factory {\n    boss-thread-prefix = "NettyBoss"\n    worker-thread-prefix = "NettyServerNIOWorker"\n    server-executor-thread-prefix = "NettyServerBizHandler"\n    share-boss-worker = false\n    client-selector-thread-prefix = "NettyClientSelector"\n    client-selector-thread-size = 1\n    client-worker-thread-prefix = "NettyClientWorkerThread"\n    # netty boss thread size,will not be used for UDT\n    boss-thread-size = 1\n    #auto default pin or 8\n    worker-thread-size = 8\n  }\n  shutdown {\n    # when destroy server, wait seconds\n    wait = 3\n  }\n  serialization = "seata"\n  compressor = "none"\n}\nservice {\n  #vgroup->rgroup\n  vgroup_mapping.bsx_group = "default"\n  #only support single node\n  default.grouplist = "127.0.0.1:8091"\n  #degrade current not support\n  enableDegrade = false\n  #disable\n  disable = false\n  #unit ms,s,m,h,d represents milliseconds, seconds, minutes, hours, days, default permanent\n  max.commit.retry.timeout = "-1"\n  max.rollback.retry.timeout = "-1"\n}\n\nclient {\n  async.commit.buffer.limit = 10000\n  lock {\n    retry.internal = 10\n    retry.times = 30\n  }\n  report.retry.count = 5\n  tm.commit.retry.count = 1\n  tm.rollback.retry.count = 1\n}\n\n## transaction log store\nstore {\n  ## store mode: file\u3001db\n  # mode = "file"\n  mode = "db" # \u4fee\u6539\u4e3a\u4f7f\u7528\u6570\u636e\u5e93\u5b58\u50a8\n\n  ## file store\n  file {\n    dir = "sessionStore"\n\n    # branch session size , if exceeded first try compress lockkey, still exceeded throws exceptions\n    max-branch-session-size = 16384\n    # globe session size , if exceeded throws exceptions\n    max-global-session-size = 512\n    # file buffer size , if exceeded allocate new buffer\n    file-write-buffer-cache-size = 16384\n    # when recover batch read size\n    session.reload.read_size = 100\n    # async, sync\n    flush-disk-mode = async\n  }\n\n  ## database store\n  db {\n    ## the implement of javax.sql.DataSource, such as DruidDataSource(druid)/BasicDataSource(dbcp) etc.\n    datasource = "dbcp"\n    ## mysql/oracle/h2/oceanbase etc.\n    db-type = "mysql"\n    driver-class-name = "com.mysql.jdbc.Driver"\n    url = "jdbc:mysql://127.0.0.1:3306/seata"\n    user = "root"\n    password = "root"\n    min-conn = 1\n    max-conn = 3\n    global.table = "global_table"\n    branch.table = "branch_table"\n    lock-table = "lock_table"\n    query-limit = 100\n  }\n}\nlock {\n  ## the lock store mode: local\u3001remote\n  mode = "remote"\n\n  local {\n    ## store locks in user\'s database\n  }\n\n  remote {\n    ## store locks in the seata\'s server\n  }\n}\nrecovery {\n  #schedule committing retry period in milliseconds\n  committing-retry-period = 1000\n  #schedule asyn committing retry period in milliseconds\n  asyn-committing-retry-period = 1000\n  #schedule rollbacking retry period in milliseconds\n  rollbacking-retry-period = 1000\n  #schedule timeout retry period in milliseconds\n  timeout-retry-period = 1000\n}\n\ntransaction {\n  undo.data.validation = true\n  undo.log.serialization = "jackson"\n  undo.log.save.days = 7\n  #schedule delete expired undo_log in milliseconds\n  undo.log.delete.period = 86400000\n  undo.log.table = "undo_log"\n}\n\n## metrics settings\nmetrics {\n  enabled = false\n  registry-type = "compact"\n  # multi exporters use comma divided\n  exporter-list = "prometheus"\n  exporter-prometheus-port = 9898\n}\n\nsupport {\n  ## spring\n  spring {\n    # auto proxy the DataSource bean\n    datasource.autoproxy = false\n  }\n}\n'))),Object(c.b)(i.a,{value:"6",mdxType:"TabItem"},Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("strong",{parentName:"li"},"\u5728\u5fae\u670d\u52a1 ",Object(c.b)("inlineCode",{parentName:"strong"},"resource")," \u8def\u5f84\u4e0b\u521b\u5efa ",Object(c.b)("inlineCode",{parentName:"strong"},"registry.conf"))," \u4f9d\u7167 seata-server \u5b89\u88c5\u65f6\u4fee\u6539\u7684\u5185\u5bb9\u586b\u5199")),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),'registry {\n  # file \u3001nacos \u3001eureka\u3001redis\u3001zk\u3001consul\u3001etcd3\u3001sofa\n  # type = "file"\n  type = "nacos" # \u4fee\u6539\u4e3a nacos\n\n  nacos {\n    serverAddr = "localhost:8848"\n    namespace = ""\n    cluster = "default"\n  }\n  eureka {\n    serviceUrl = "http://localhost:8761/eureka"\n    application = "default"\n    weight = "1"\n  }\n  redis {\n    serverAddr = "localhost:6379"\n    db = "0"\n  }\n  zk {\n    cluster = "default"\n    serverAddr = "127.0.0.1:2181"\n    session.timeout = 6000\n    connect.timeout = 2000\n  }\n  consul {\n    cluster = "default"\n    serverAddr = "127.0.0.1:8500"\n  }\n  etcd3 {\n    cluster = "default"\n    serverAddr = "http://localhost:2379"\n  }\n  sofa {\n    serverAddr = "127.0.0.1:9603"\n    application = "default"\n    region = "DEFAULT_ZONE"\n    datacenter = "DefaultDataCenter"\n    cluster = "default"\n    group = "SEATA_GROUP"\n    addressWaitTime = "3000"\n  }\n  file {\n    name = "file.conf"\n  }\n}\n\nconfig {\n  # file\u3001nacos \u3001apollo\u3001zk\u3001consul\u3001etcd3\n  type = "file"\n\n  nacos {\n    serverAddr = "localhost"\n    namespace = ""\n  }\n  consul {\n    serverAddr = "127.0.0.1:8500"\n  }\n  apollo {\n    app.id = "seata-server"\n    apollo.meta = "http://192.168.1.204:8801"\n  }\n  zk {\n    serverAddr = "127.0.0.1:2181"\n    session.timeout = 6000\n    connect.timeout = 2000\n  }\n  etcd3 {\n    serverAddr = "http://localhost:2379"\n  }\n  file {\n    name = "file.conf"\n  }\n}\n'))),Object(c.b)(i.a,{value:"7",mdxType:"TabItem"},Object(c.b)("h2",Object(a.a)({parentName:"blockquote"},{id:"dao-mapper-1"}),"Dao (Mapper)"),Object(c.b)("h3",Object(a.a)({parentName:"blockquote"},{id:"\u63a5\u53e3-1"}),"\u63a5\u53e3"),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java",metastring:'title="dao.StorageDao"',title:'"dao.StorageDao"'}),'@Mapper\npublic interface StorageDao {\n\n    void decrease(@Param("productId") Long productId,@Param("count") Integer count);\n}\n')),Object(c.b)("h3",Object(a.a)({parentName:"blockquote"},{id:"storagemapperxml"}),"StorageMapper.xml"),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-xml"}),'<?xml version="1.0" encoding="UTF-8" ?>\n<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"\n        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">\n<mapper namespace="com.bsx.springcloud.dao.StorageDao">\n\n    <resultMap id="BaseResultMap" type="com.bsx.springcloud.domian.Storage">\n        <id column="id" property="id" jdbcType="BIGINT"></id>\n        <result column="product_id" property="productId" jdbcType="BIGINT"></result>\n        <result column="total" property="total" jdbcType="INTEGER"></result>\n        <result column="used" property="used" jdbcType="INTEGER"></result>\n        <result column="residue" property="residue" jdbcType="INTEGER"></result>\n    </resultMap>\n\n    <update id="decrease">\n        update t_storage\n        set used = used + #{count},residue = residue - #{count}\n        where  product_id= #{productId};\n    </update>\n</mapper>\n')),Object(c.b)("h2",Object(a.a)({parentName:"blockquote"},{id:"service-1"}),"Service"),Object(c.b)("h3",Object(a.a)({parentName:"blockquote"},{id:"storageservice-1"}),"StorageService"),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),"public interface StorageService {\n    void decrease(Long productId, Integer count);\n}\n")),Object(c.b)("h4",Object(a.a)({parentName:"blockquote"},{id:"impl-1"}),"impl"),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),'@Service\npublic class StorageServiceImpl implements StorageService {\n\n    private static final Logger LOGGER = LoggerFactory.getLogger(StorageServiceImpl.class);\n\n    @Resource\n    private StorageDao storageDao;\n\n    @Override\n    public void decrease(Long productId, Integer count) {\n        LOGGER.info("----\x3e storage-service\u4e2d\u6263\u51cf\u5e93\u5b58\u5f00\u59cb");\n        storageDao.decrease(productId, count);\n        LOGGER.info("----\x3e storage-service\u4e2d\u6263\u51cf\u5e93\u5b58\u7ed3\u675f");\n    }\n}\n')),Object(c.b)("h2",Object(a.a)({parentName:"blockquote"},{id:"controller-1"}),"Controller"),Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("strong",{parentName:"li"},"StorageController"))),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),'@RestController\npublic class StorageController {\n\n    @Resource\n    private StorageService storageService;\n\n    @RequestMapping("/storage/decrease")\n    public CommonResult decrease(Long productId, Integer count) {\n        storageService.decrease(productId, count);\n        return new CommonResult(200, "\u6263\u51cf\u5e93\u5b58\u6210\u529f!");\n    }\n}\n'))),Object(c.b)(i.a,{value:"8",mdxType:"TabItem"},Object(c.b)("h2",Object(a.a)({parentName:"blockquote"},{id:"seata-mybatis-\u6574\u5408\u914d\u7f6e-1"}),"Seata Mybatis \u6574\u5408\u914d\u7f6e"),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java",metastring:'title="config.MyBatisConfig \u914d\u7f6e\u5305\u626b\u63cf"',title:'"config.MyBatisConfig','\u914d\u7f6e\u5305\u626b\u63cf"':!0}),'@Configuration\n@MapperScan({"com.bsx.springcloud.dao"})\npublic class MyBatisConfig {\n\n}\n')),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java",metastring:'title="config.DataSourceProxyConfig \u6570\u636e\u6e90\u4ee3\u7406"',title:'"config.DataSourceProxyConfig','\u6570\u636e\u6e90\u4ee3\u7406"':!0}),'/**\n * \u4f7f\u7528Seata\u5bf9\u6570\u636e\u6e90\u8fdb\u884c\u4ee3\u7406\n */\n@Configuration\npublic class DataSourceProxyConfig {\n\n    @Value("${mybatis.mapperLocations}")\n    private String mapperLocations;\n\n    @Bean\n    @ConfigurationProperties(prefix = "spring.datasource")\n    public DataSource druidDataSource() {\n        return new DruidDataSource();\n    }\n\n    @Bean\n    public DataSourceProxy dataSourceProxy(DataSource druidDataSource) {\n        return new DataSourceProxy(druidDataSource);\n    }\n\n    @Bean\n    public SqlSessionFactory sqlSessionFactoryBean(DataSourceProxy dataSourceProxy) throws Exception {\n        SqlSessionFactoryBean bean = new SqlSessionFactoryBean();\n        bean.setDataSource(dataSourceProxy);\n        ResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();\n        bean.setMapperLocations(resolver.getResources(mapperLocations));\n        return bean.getObject();\n    }\n}\n'))))),Object(c.b)("h1",{id:"account-module"},"Account-Module"),Object(c.b)("blockquote",null,Object(c.b)("h3",Object(a.a)({parentName:"blockquote"},{id:"seata-account-service2003"}),"seata-account-service2003"),Object(c.b)(o.a,{defaultValue:"1",values:[{label:"POM",value:"1"},{label:"YAML",value:"2"},{label:"\u4e3b\u542f\u52a8",value:"3"},{label:"\u5b9e\u4f53\u7c7b",value:"4"},{label:"file.conf",value:"5"},{label:"registry.conf",value:"6"},{label:"\u4e1a\u52a1\u7c7b",value:"7"},{label:"\u914d\u7f6e\u7c7b",value:"8"}],mdxType:"Tabs"},Object(c.b)(i.a,{value:"1",mdxType:"TabItem"},Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-xml"}),"<dependencies>\n\x3c!-- nacos --\x3e\n<dependency>\n<groupId>com.alibaba.cloud</groupId>\n<artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>\n</dependency>\n\x3c!-- seata--\x3e\n<dependency>\n<groupId>com.alibaba.cloud</groupId>\n<artifactId>spring-cloud-starter-alibaba-seata</artifactId>\n<exclusions>\n<exclusion>\n    <groupId>io.seata</groupId>\n    <artifactId>seata-all</artifactId>\n</exclusion>\n</exclusions>\n</dependency>\n<dependency>\n<groupId>io.seata</groupId>\n<artifactId>seata-all</artifactId>\n<version>0.9.0</version>\n</dependency>\n<dependency>\n<groupId>org.springframework.cloud</groupId>\n<artifactId>spring-cloud-starter-openfeign</artifactId>\n</dependency>\n<dependency>\n<groupId>org.springframework.boot</groupId>\n<artifactId>spring-boot-starter-web</artifactId>\n</dependency>\n<dependency>\n<groupId>org.mybatis.spring.boot</groupId>\n<artifactId>mybatis-spring-boot-starter</artifactId>\n</dependency>\n<dependency>\n<groupId>com.alibaba</groupId>\n<artifactId>druid</artifactId>\n</dependency>\n<dependency>\n<groupId>mysql</groupId>\n<artifactId>mysql-connector-java</artifactId>\n</dependency>\n\x3c!--jdbc--\x3e\n<dependency>\n<groupId>org.springframework.boot</groupId>\n<artifactId>spring-boot-starter-jdbc</artifactId>\n</dependency>\n<dependency>\n<groupId>org.springframework.boot</groupId>\n<artifactId>spring-boot-starter-actuator</artifactId>\n</dependency>\n<dependency>\n<groupId>org.projectlombok</groupId>\n<artifactId>lombok</artifactId>\n<optional>true</optional>\n</dependency>\n<dependency>\n<groupId>org.springframework.boot</groupId>\n<artifactId>spring-boot-starter-test</artifactId>\n<scope>test</scope>\n</dependency>\n\x3c!--hutool \u6d4b\u8bd5\u96ea\u82b1\u7b97\u6cd5--\x3e\n<dependency>\n<groupId>cn.hutool</groupId>\n<artifactId>hutool-captcha</artifactId>\n<version>5.2.0</version>\n</dependency>\n\x3c!-- https://mvnrepository.com/artifact/com.google.errorprone/error_prone_core --\x3e\n\x3c!--<dependency>\n<groupId>com.google.errorprone</groupId>\n<artifactId>error_prone_core</artifactId>\n<version>0.92</version>\n</dependency>--\x3e\n</dependencies>\n"))),Object(c.b)(i.a,{value:"2",mdxType:"TabItem"},Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),"server:\n  port: 2003\n\nspring:\n  application:\n    name: seata-account-service\n  cloud:\n    alibaba:\n      seata:\n        # \u81ea\u5b9a\u4e49\u4e8b\u52a1\u7ec4\u540d\u79f0\u9700\u8981\u4e0eseata-server\u4e2d\u7684\u5bf9\u5e94\n        tx-service-group: bsx_group\n    nacos:\n      discovery:\n        server-addr: 127.0.0.1:8848\n  datasource:\n    # \u5f53\u524d\u6570\u636e\u6e90\u64cd\u4f5c\u7c7b\u578b\n    type: com.alibaba.druid.pool.DruidDataSource\n    # mysql\u9a71\u52a8\u7c7b\n    driver-class-name: com.mysql.jdbc.Driver\n    url: jdbc:mysql://localhost:3306/seata_account?serverTimezone=UTC&useUnicode=true&characterEncoding=utf-8\n    username: root\n    password: root\nfeign:\n  hystrix:\n    enabled: false\nlogging:\n  level:\n    io:\n      seata: info\n\nmybatis:\n  mapperLocations: classpath:mapper/*.xml\n"))),Object(c.b)(i.a,{value:"3",mdxType:"TabItem"},Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},"\u53d6\u6d88\u6570\u636e\u6e90\u81ea\u52a8\u521b\u5efa\uff0c\u56e0\u4e3a\u540e\u7eed\u4f1a\u914d\u7f6e\u6570\u636e\u6e90\u4ee3\u7406")),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),"@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)\n@EnableFeignClients\n@EnableDiscoveryClient\npublic class SeataAccountMain2003 {\n\n    public static void main(String[] args) {\n        SpringApplication.run(SeataAccountMain2003.class,args);\n    }\n}\n"))),Object(c.b)(i.a,{value:"4",mdxType:"TabItem"},Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java",metastring:'title="domain.CommonResult"',title:'"domain.CommonResult"'}),"@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class CommonResult<T> {\n    private Integer code;\n    private String message;\n    private T data;\n\n    public CommonResult(Integer code, String message) {\n        this(code, message, null);\n    }\n}\n")),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java",metastring:'title="domain.Account"',title:'"domain.Account"'}),"@Data\n@AllArgsConstructor\n@NoArgsConstructor\npublic class Storage {\n\n    private Long id;\n\n    private Long productId;\n\n    private Integer total;\n\n    private Integer used;\n\n    private Integer residue;\n}\n"))),Object(c.b)(i.a,{value:"5",mdxType:"TabItem"},Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("strong",{parentName:"li"},"\u5728\u5fae\u670d\u52a1 ",Object(c.b)("inlineCode",{parentName:"strong"},"resource")," \u8def\u5f84\u4e0b\u521b\u5efa ",Object(c.b)("inlineCode",{parentName:"strong"},"file.conf"))," ")),Object(c.b)("div",Object(a.a)({parentName:"blockquote"},{className:"admonition admonition-warning alert alert--danger"}),Object(c.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(c.b)("h5",{parentName:"div"},Object(c.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(c.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(c.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"})))),"\u5927\u5751")),Object(c.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(c.b)("ul",{parentName:"div"},Object(c.b)("li",{parentName:"ul"},"\u5728 seata \u5b89\u88c5\u76ee\u5f55 ",Object(c.b)("inlineCode",{parentName:"li"},"/conf/file.conf")," \u6587\u4ef6\u4e2d\uff0c\u6709\u4e00\u4e2a ",Object(c.b)("inlineCode",{parentName:"li"},'service.vgroup_mapping.my_test_tx_group = "bsx_group"'),"\uff0c\u6b64\u5904\u6211\u8bbe\u7f6e\u4e3a\u4e86 ",Object(c.b)("inlineCode",{parentName:"li"},"bsx_group")),Object(c.b)("li",{parentName:"ul"},"\u5728\u4e09\u4e2a\u5fae\u670d\u52a1\u7684 ",Object(c.b)("inlineCode",{parentName:"li"},"resource/file.conf")," \u4e2d\uff0c\u8981\u6539\u5199\u4e3a ",Object(c.b)("inlineCode",{parentName:"li"},'service.vgroup_mapping.bsx_group = "default"'),Object(c.b)("ul",{parentName:"li"},Object(c.b)("li",{parentName:"ul"},"service.vgroup.mapping. \u4e4b\u540e\u63a5\u4e0a seata \u8def\u5f84\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7684 ",Object(c.b)("inlineCode",{parentName:"li"},"bsx_group")),Object(c.b)("li",{parentName:"ul"},"\u503c ",Object(c.b)("inlineCode",{parentName:"li"},"default")," \u968f\u4fbf\uff0c\u5efa\u8bae\u5c31\u5199 ",Object(c.b)("inlineCode",{parentName:"li"},"default"))))))),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),'transport {\n  # tcp udt unix-domain-socket\n  type = "TCP"\n  #NIO NATIVE\n  server = "NIO"\n  #enable heartbeat\n  heartbeat = true\n  #thread factory for netty\n  thread-factory {\n    boss-thread-prefix = "NettyBoss"\n    worker-thread-prefix = "NettyServerNIOWorker"\n    server-executor-thread-prefix = "NettyServerBizHandler"\n    share-boss-worker = false\n    client-selector-thread-prefix = "NettyClientSelector"\n    client-selector-thread-size = 1\n    client-worker-thread-prefix = "NettyClientWorkerThread"\n    # netty boss thread size,will not be used for UDT\n    boss-thread-size = 1\n    #auto default pin or 8\n    worker-thread-size = 8\n  }\n  shutdown {\n    # when destroy server, wait seconds\n    wait = 3\n  }\n  serialization = "seata"\n  compressor = "none"\n}\nservice {\n  #vgroup->rgroup\n  vgroup_mapping.bsx_group = "default"\n  #only support single node\n  default.grouplist = "127.0.0.1:8091"\n  #degrade current not support\n  enableDegrade = false\n  #disable\n  disable = false\n  #unit ms,s,m,h,d represents milliseconds, seconds, minutes, hours, days, default permanent\n  max.commit.retry.timeout = "-1"\n  max.rollback.retry.timeout = "-1"\n}\n\nclient {\n  async.commit.buffer.limit = 10000\n  lock {\n    retry.internal = 10\n    retry.times = 30\n  }\n  report.retry.count = 5\n  tm.commit.retry.count = 1\n  tm.rollback.retry.count = 1\n}\n\n## transaction log store\nstore {\n  ## store mode: file\u3001db\n  # mode = "file"\n  mode = "db" # \u4fee\u6539\u4e3a\u4f7f\u7528\u6570\u636e\u5e93\u5b58\u50a8\n\n  ## file store\n  file {\n    dir = "sessionStore"\n\n    # branch session size , if exceeded first try compress lockkey, still exceeded throws exceptions\n    max-branch-session-size = 16384\n    # globe session size , if exceeded throws exceptions\n    max-global-session-size = 512\n    # file buffer size , if exceeded allocate new buffer\n    file-write-buffer-cache-size = 16384\n    # when recover batch read size\n    session.reload.read_size = 100\n    # async, sync\n    flush-disk-mode = async\n  }\n\n  ## database store\n  db {\n    ## the implement of javax.sql.DataSource, such as DruidDataSource(druid)/BasicDataSource(dbcp) etc.\n    datasource = "dbcp"\n    ## mysql/oracle/h2/oceanbase etc.\n    db-type = "mysql"\n    driver-class-name = "com.mysql.jdbc.Driver"\n    url = "jdbc:mysql://127.0.0.1:3306/seata"\n    user = "root"\n    password = "root"\n    min-conn = 1\n    max-conn = 3\n    global.table = "global_table"\n    branch.table = "branch_table"\n    lock-table = "lock_table"\n    query-limit = 100\n  }\n}\nlock {\n  ## the lock store mode: local\u3001remote\n  mode = "remote"\n\n  local {\n    ## store locks in user\'s database\n  }\n\n  remote {\n    ## store locks in the seata\'s server\n  }\n}\nrecovery {\n  #schedule committing retry period in milliseconds\n  committing-retry-period = 1000\n  #schedule asyn committing retry period in milliseconds\n  asyn-committing-retry-period = 1000\n  #schedule rollbacking retry period in milliseconds\n  rollbacking-retry-period = 1000\n  #schedule timeout retry period in milliseconds\n  timeout-retry-period = 1000\n}\n\ntransaction {\n  undo.data.validation = true\n  undo.log.serialization = "jackson"\n  undo.log.save.days = 7\n  #schedule delete expired undo_log in milliseconds\n  undo.log.delete.period = 86400000\n  undo.log.table = "undo_log"\n}\n\n## metrics settings\nmetrics {\n  enabled = false\n  registry-type = "compact"\n  # multi exporters use comma divided\n  exporter-list = "prometheus"\n  exporter-prometheus-port = 9898\n}\n\nsupport {\n  ## spring\n  spring {\n    # auto proxy the DataSource bean\n    datasource.autoproxy = false\n  }\n}\n'))),Object(c.b)(i.a,{value:"6",mdxType:"TabItem"},Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("strong",{parentName:"li"},"\u5728\u5fae\u670d\u52a1 ",Object(c.b)("inlineCode",{parentName:"strong"},"resource")," \u8def\u5f84\u4e0b\u521b\u5efa ",Object(c.b)("inlineCode",{parentName:"strong"},"registry.conf"))," \u4f9d\u7167 seata-server \u5b89\u88c5\u65f6\u4fee\u6539\u7684\u5185\u5bb9\u586b\u5199")),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),'registry {\n  # file \u3001nacos \u3001eureka\u3001redis\u3001zk\u3001consul\u3001etcd3\u3001sofa\n  # type = "file"\n  type = "nacos" # \u4fee\u6539\u4e3a nacos\n\n  nacos {\n    serverAddr = "localhost:8848"\n    namespace = ""\n    cluster = "default"\n  }\n  eureka {\n    serviceUrl = "http://localhost:8761/eureka"\n    application = "default"\n    weight = "1"\n  }\n  redis {\n    serverAddr = "localhost:6379"\n    db = "0"\n  }\n  zk {\n    cluster = "default"\n    serverAddr = "127.0.0.1:2181"\n    session.timeout = 6000\n    connect.timeout = 2000\n  }\n  consul {\n    cluster = "default"\n    serverAddr = "127.0.0.1:8500"\n  }\n  etcd3 {\n    cluster = "default"\n    serverAddr = "http://localhost:2379"\n  }\n  sofa {\n    serverAddr = "127.0.0.1:9603"\n    application = "default"\n    region = "DEFAULT_ZONE"\n    datacenter = "DefaultDataCenter"\n    cluster = "default"\n    group = "SEATA_GROUP"\n    addressWaitTime = "3000"\n  }\n  file {\n    name = "file.conf"\n  }\n}\n\nconfig {\n  # file\u3001nacos \u3001apollo\u3001zk\u3001consul\u3001etcd3\n  type = "file"\n\n  nacos {\n    serverAddr = "localhost"\n    namespace = ""\n  }\n  consul {\n    serverAddr = "127.0.0.1:8500"\n  }\n  apollo {\n    app.id = "seata-server"\n    apollo.meta = "http://192.168.1.204:8801"\n  }\n  zk {\n    serverAddr = "127.0.0.1:2181"\n    session.timeout = 6000\n    connect.timeout = 2000\n  }\n  etcd3 {\n    serverAddr = "http://localhost:2379"\n  }\n  file {\n    name = "file.conf"\n  }\n}\n'))),Object(c.b)(i.a,{value:"7",mdxType:"TabItem"},Object(c.b)("h2",Object(a.a)({parentName:"blockquote"},{id:"dao-mapper-2"}),"Dao (Mapper)"),Object(c.b)("h3",Object(a.a)({parentName:"blockquote"},{id:"\u63a5\u53e3-2"}),"\u63a5\u53e3"),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java",metastring:'title="dao.AccountDao"',title:'"dao.AccountDao"'}),'@Mapper\npublic interface AccountDao {\n\n    /**\n     * \u6263\u51cf\u8d26\u6237\u4f59\u989d\n     *\n     * @param userId\n     * @param money\n     */\n    void decrease(@Param("userId") Long userId, @Param("money") BigDecimal money);\n}\n')),Object(c.b)("h3",Object(a.a)({parentName:"blockquote"},{id:"accountmapperxml"}),"AccountMapper.xml"),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-xml"}),'<?xml version="1.0" encoding="UTF-8" ?>\n<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"\n        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">\n<mapper namespace="com.bsx.springcloud.dao.AccountDao">\n\n    <resultMap id="BaseResultMap" type="com.bsx.springcloud.domain.Account">\n        <id column="id" property="id" jdbcType="BIGINT"></id>\n        <result column="user_id" property="userId" jdbcType="BIGINT"></result>\n        <result column="total" property="total" jdbcType="DECIMAL"></result>\n        <result column="used" property="used" jdbcType="DECIMAL"></result>\n        <result column="residue" property="residue" jdbcType="DECIMAL"></result>\n    </resultMap>\n\n    <update id="decrease">\n        update t_account\n        set used = used + #{money},residue = residue - #{money}\n        where  user_id= #{userId};\n    </update>\n</mapper>\n')),Object(c.b)("h2",Object(a.a)({parentName:"blockquote"},{id:"service-2"}),"Service"),Object(c.b)("h3",Object(a.a)({parentName:"blockquote"},{id:"accountservice-1"}),"AccountService"),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),"public interface AccountService {\n    void decrease(Long userId, BigDecimal money);\n}\n")),Object(c.b)("h4",Object(a.a)({parentName:"blockquote"},{id:"impl-2"}),"impl"),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),'@Service\npublic class AccountServiceImpl implements AccountService {\n\n    private static final Logger LOGGER = LoggerFactory.getLogger(AccountServiceImpl.class);\n\n    @Resource\n    private AccountDao accountDao;\n\n    @Override\n    public void decrease(Long userId, BigDecimal money) {\n        LOGGER.info("----\x3e account-service\u4e2d\u6263\u51cf\u7528\u6237\u4f59\u989d\u5f00\u59cb");\n\n        /*try {\n            TimeUnit.SECONDS.sleep(20);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }*/\n        accountDao.decrease(userId, money);\n        LOGGER.info("----\x3e account-service\u4e2d\u6263\u51cf\u7528\u6237\u4f59\u989d\u5f00\u59cb");\n    }\n}\n')),Object(c.b)("h2",Object(a.a)({parentName:"blockquote"},{id:"controller-2"}),"Controller"),Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("strong",{parentName:"li"},"AccountController"))),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),'@RestController\npublic class AccountController {\n\n    @Resource\n    AccountService accountService;\n\n    @RequestMapping("/account/decrease")\n    public CommonResult decrease(@RequestParam("userId") Long userId, @RequestParam("money") BigDecimal money) {\n        accountService.decrease(userId, money);\n        return new CommonResult(200, "\u6263\u51cf\u8d26\u6237\u4f59\u989d\u6210\u529f\uff01");\n    }\n}\n'))),Object(c.b)(i.a,{value:"8",mdxType:"TabItem"},Object(c.b)("h2",Object(a.a)({parentName:"blockquote"},{id:"seata-mybatis-\u6574\u5408\u914d\u7f6e-2"}),"Seata Mybatis \u6574\u5408\u914d\u7f6e"),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java",metastring:'title="config.MyBatisConfig \u914d\u7f6e\u5305\u626b\u63cf"',title:'"config.MyBatisConfig','\u914d\u7f6e\u5305\u626b\u63cf"':!0}),'@Configuration\n@MapperScan({"com.bsx.springcloud.dao"})\npublic class MyBatisConfig {\n\n}\n')),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java",metastring:'title="config.DataSourceProxyConfig \u6570\u636e\u6e90\u4ee3\u7406"',title:'"config.DataSourceProxyConfig','\u6570\u636e\u6e90\u4ee3\u7406"':!0}),'/**\n * \u4f7f\u7528Seata\u5bf9\u6570\u636e\u6e90\u8fdb\u884c\u4ee3\u7406\n */\n@Configuration\npublic class DataSourceProxyConfig {\n\n    @Value("${mybatis.mapperLocations}")\n    private String mapperLocations;\n\n    @Bean\n    @ConfigurationProperties(prefix = "spring.datasource")\n    public DataSource druidDataSource() {\n        return new DruidDataSource();\n    }\n\n    @Bean\n    public DataSourceProxy dataSourceProxy(DataSource druidDataSource) {\n        return new DataSourceProxy(druidDataSource);\n    }\n\n    @Bean\n    public SqlSessionFactory sqlSessionFactoryBean(DataSourceProxy dataSourceProxy) throws Exception {\n        SqlSessionFactoryBean bean = new SqlSessionFactoryBean();\n        bean.setDataSource(dataSourceProxy);\n        ResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();\n        bean.setMapperLocations(resolver.getResources(mapperLocations));\n        return bean.getObject();\n    }\n}\n'))))),Object(c.b)("br",null),Object(c.b)("h1",{id:"\u4f7f\u7528"},"\u4f7f\u7528"),Object(c.b)("blockquote",null,Object(c.b)("h2",Object(a.a)({parentName:"blockquote"},{id:"\u9ed8\u8ba4\u4e09\u4e2a\u6570\u636e\u5e93\u7684\u4e09\u5f20\u8868\u6570\u636e\u60c5\u51b5"}),"\u9ed8\u8ba4\u4e09\u4e2a\u6570\u636e\u5e93\u7684\u4e09\u5f20\u8868\u6570\u636e\u60c5\u51b5"),Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"seata_account -> t_account"),"\u8868")),Object(c.b)("table",{parentName:"blockquote"},Object(c.b)("thead",{parentName:"table"},Object(c.b)("tr",{parentName:"thead"},Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"user_id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"total"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"used"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"residue"))),Object(c.b)("tbody",{parentName:"table"},Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1000"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"0"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1000")))),Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"seata_order -> t_order")," \u8868")),Object(c.b)("table",{parentName:"blockquote"},Object(c.b)("thead",{parentName:"table"},Object(c.b)("tr",{parentName:"thead"},Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"user_id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"product_id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"count"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"money"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"status"))),Object(c.b)("tbody",{parentName:"table"},Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"-"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"-"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"-"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"-"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"-"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"-")))),Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"seata_storage -> t_storage")," \u8868")),Object(c.b)("table",{parentName:"blockquote"},Object(c.b)("thead",{parentName:"table"},Object(c.b)("tr",{parentName:"thead"},Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"product_id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"total"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"used"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"residue"))),Object(c.b)("tbody",{parentName:"table"},Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"100"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"0"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"100"))))),Object(c.b)("h2",{id:"\u6b63\u5e38\u4e0b\u5355"},"\u6b63\u5e38\u4e0b\u5355"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"\u8bbf\u95ee http://localhost:2001/order/create?userId=1&productId=1&count=10&money=100",Object(c.b)("ul",{parentName:"li"},Object(c.b)("li",{parentName:"ul"},"1 \u53f7\u7528\u6237\uff0c\u4e70 1 \u53f7\u4ea7\u54c1\uff0c\u4e70\u4e86 10 \u4e2a\uff0c\u82b1\u8d39 100 \u5757\u94b1"))),Object(c.b)("li",{parentName:"ul"},"\u67e5\u770b\u6570\u636e\u5e93\u53d8\u5316")),Object(c.b)("blockquote",null,Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"seata_account -> t_account"),"\u8868")),Object(c.b)("table",{parentName:"blockquote"},Object(c.b)("thead",{parentName:"table"},Object(c.b)("tr",{parentName:"thead"},Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"user_id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"total"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"used"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"residue"))),Object(c.b)("tbody",{parentName:"table"},Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1000"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"100"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"900")))),Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"seata_order -> t_order")," \u8868")),Object(c.b)("table",{parentName:"blockquote"},Object(c.b)("thead",{parentName:"table"},Object(c.b)("tr",{parentName:"thead"},Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"user_id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"product_id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"count"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"money"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"status"))),Object(c.b)("tbody",{parentName:"table"},Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"7"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"10"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"100"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1")))),Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"seata_storage -> t_storage")," \u8868")),Object(c.b)("table",{parentName:"blockquote"},Object(c.b)("thead",{parentName:"table"},Object(c.b)("tr",{parentName:"thead"},Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"product_id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"total"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"used"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"residue"))),Object(c.b)("tbody",{parentName:"table"},Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"100"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"10"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"90"))))),Object(c.b)("p",null,Object(c.b)("strong",{parentName:"p"},"\u6b63\u5e38\u5b8c\u6210\u4e1a\u52a1\uff0c\u6ca1\u6bdb\u75c5\uff01")),Object(c.b)("h2",{id:"globaltransactional-\u6ce8\u89e3"},"@GlobalTransactional \u6ce8\u89e3"),Object(c.b)("h3",{id:"\u8d85\u65f6\u5f02\u5e38--\u6ca1\u52a0-globaltransactional"},"\u8d85\u65f6\u5f02\u5e38 + \u6ca1\u52a0 @GlobalTransactional"),Object(c.b)("blockquote",null,Object(c.b)("h2",Object(a.a)({parentName:"blockquote"},{id:"\u6545\u610f\u9020\u5f02\u5e38"}),"\u6545\u610f\u9020\u5f02\u5e38"),Object(c.b)("h3",Object(a.a)({parentName:"blockquote"},{id:"account-module-1"}),"Account-Module"),Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("strong",{parentName:"li"},"\u5728 Account-service2003 \u7684 Service \u5c42 Impl \u4ee3\u7801\u4e2d\uff0c\u6545\u610f\u6dfb\u52a0\u4e00\u4e2a 20 \u79d2\u7761\u7720\uff0c\u6765\u5236\u9020 ",Object(c.b)("inlineCode",{parentName:"strong"},"\u8d85\u65f6\u5f02\u5e38")))),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),'@Service\npublic class AccountServiceImpl implements AccountService {\n\n    private static final Logger LOGGER = LoggerFactory.getLogger(AccountServiceImpl.class);\n\n    @Resource\n    private AccountDao accountDao;\n\n    @Override\n    public void decrease(Long userId, BigDecimal money) {\n        LOGGER.info("----\x3e account-service\u4e2d\u6263\u51cf\u7528\u6237\u4f59\u989d\u5f00\u59cb");\n\n        try {\n            TimeUnit.SECONDS.sleep(20);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        \n        accountDao.decrease(userId, money);\n        LOGGER.info("----\x3e account-service\u4e2d\u6263\u51cf\u7528\u6237\u4f59\u989d\u5f00\u59cb");\n    }\n}\n')),Object(c.b)("h2",Object(a.a)({parentName:"blockquote"},{id:"\u6267\u884c\u4e1a\u52a1"}),"\u6267\u884c\u4e1a\u52a1"),Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},"\u8bbf\u95ee http://localhost:2001/order/create?userId=1&productId=1&count=10&money=100",Object(c.b)("ul",{parentName:"li"},Object(c.b)("li",{parentName:"ul"},"1 \u53f7\u7528\u6237\uff0c\u4e70 1 \u53f7\u4ea7\u54c1\uff0c\u4e70\u4e86 10 \u4e2a\uff0c\u82b1\u8d39 100 \u5757\u94b1"))),Object(c.b)("li",{parentName:"ul"},"\u6b64\u5904\u4f1a\u89e6\u53d1 OpenFeign \u8d85\u65f6\u5f02\u5e38"),Object(c.b)("li",{parentName:"ul"},"\u67e5\u770b\u6570\u636e\u5e93\u53d8\u5316")),Object(c.b)("blockquote",{parentName:"blockquote"},Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"seata_account -> t_account"),"\u8868")),Object(c.b)("table",{parentName:"blockquote"},Object(c.b)("thead",{parentName:"table"},Object(c.b)("tr",{parentName:"thead"},Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"user_id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"total"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"used"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"residue"))),Object(c.b)("tbody",{parentName:"table"},Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1000"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"200"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"800")))),Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"seata_order -> t_order")," \u8868")),Object(c.b)("table",{parentName:"blockquote"},Object(c.b)("thead",{parentName:"table"},Object(c.b)("tr",{parentName:"thead"},Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"user_id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"product_id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"count"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"money"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"status"))),Object(c.b)("tbody",{parentName:"table"},Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"7"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"10"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"100"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1")),Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"8"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"10"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"100"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"0")))),Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"seata_storage -> t_storage")," \u8868")),Object(c.b)("table",{parentName:"blockquote"},Object(c.b)("thead",{parentName:"table"},Object(c.b)("tr",{parentName:"thead"},Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"product_id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"total"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"used"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"residue"))),Object(c.b)("tbody",{parentName:"table"},Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"100"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"20"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"80"))))),Object(c.b)("div",Object(a.a)({parentName:"blockquote"},{className:"admonition admonition-caution alert alert--warning"}),Object(c.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(c.b)("h5",{parentName:"div"},Object(c.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(c.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),Object(c.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),"\u51fa\u9519")),Object(c.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(c.b)("p",{parentName:"div"},"\u51fa\u95ee\u9898\u4e86\uff01\u7531\u4e8e\u8d85\u65f6\u5f02\u5e38\uff0c\u8ba2\u5355\u7684\u6700\u7ec8\u72b6\u6001\u4e3a ",Object(c.b)("inlineCode",{parentName:"p"},"\u672a\u5b8c\u6210"),"\uff0c\u4f46\uff1a"),Object(c.b)("ul",{parentName:"div"},Object(c.b)("li",{parentName:"ul"},"\u5546\u54c1\u5e93\u5b58\u88ab\u6263\u9664\u4e86"),Object(c.b)("li",{parentName:"ul"},"\u8d26\u6237\u4f59\u989d\u4e5f\u88ab\u6263\u9664\u4e86")),Object(c.b)("br",null),Object(c.b)("p",{parentName:"div"},"\u6545\u969c\u60c5\u51b5\uff1a"),Object(c.b)("ul",{parentName:"div"},Object(c.b)("li",{parentName:"ul"},"\u5f53\u5e93\u5b58\u548c\u8d26\u6237\u91d1\u989d\u6263\u51cf\u540e\uff0c\u8ba2\u5355\u72b6\u6001\u6ca1\u6709\u8bbe\u7f6e\u6210\u5df2\u5b8c\u6210\uff0c\u6ca1\u6709\u4ece 0 \u53d8\u4e3a 1"),Object(c.b)("li",{parentName:"ul"},"\u7531\u4e8e OpenFeign \u91cd\u8bd5\u673a\u5236\uff0c\u8d26\u6237\u4f59\u989d\u8fd8\u6709\u53ef\u80fd\u88ab\u591a\u6b21\u6263\u51cf"))))),Object(c.b)("h3",{id:"\u8d85\u65f6\u5f02\u5e38--\u6dfb\u52a0-globaltransacitonal"},"\u8d85\u65f6\u5f02\u5e38 + \u6dfb\u52a0 @GlobalTransacitonal"),Object(c.b)("blockquote",null,Object(c.b)("p",{parentName:"blockquote"},"\u53ea\u9700\u8981\u5728\u4e1a\u52a1\u53d1\u8d77\u5fae\u670d\u52a1\u7684 Service \u5c42\u65b9\u6cd5\u5904\u6dfb\u52a0 ",Object(c.b)("inlineCode",{parentName:"p"},"@GlobalTransactional")," \u6ce8\u89e3\u5373\u53ef\u5f00\u542f\u5206\u5e03\u5f0f\u4e8b\u52a1\u652f\u6301")),Object(c.b)("blockquote",null,Object(c.b)("h2",Object(a.a)({parentName:"blockquote"},{id:"\u6dfb\u52a0\u6ce8\u89e3"}),"\u6dfb\u52a0\u6ce8\u89e3"),Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},"\u4f9d\u7136\u5728 ",Object(c.b)("inlineCode",{parentName:"li"},"AccountServiceImpl")," \u6dfb\u52a0\u8d85\u65f6"),Object(c.b)("li",{parentName:"ul"},"\u5728\u4e1a\u52a1\u53d1\u8d77\u5fae\u670d\u52a1\u7684 Service \u5c42\u6dfb\u52a0\u6ce8\u89e3\uff0c\u5373\u5728 ",Object(c.b)("inlineCode",{parentName:"li"},"OrderServiceImpl")," \u7684 Service \u5c42\u6dfb\u52a0 ",Object(c.b)("inlineCode",{parentName:"li"},"@GlobalTransacitonal")," \u6ce8\u89e3",Object(c.b)("ul",{parentName:"li"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"name")," \u5c5e\u6027\uff1a\u968f\u4fbf\uff0c\u4fdd\u8bc1\u552f\u4e00\u5373\u53ef"),Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"rollbackFor"),"\uff1a\u6307\u5b9a\u9047\u5230\u4ec0\u4e48\u7c7b\u578b\u7684\u5f02\u5e38\u89e6\u53d1\u56de\u6eda")))),Object(c.b)("pre",{parentName:"blockquote"},Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java",metastring:'title="OderServiceImpl"',title:'"OderServiceImpl"'}),'@Service\n@Slf4j\npublic class OrderServiceImpl implements OrderService {\n\n    @Resource\n    private OrderDao orderDao;\n    @Resource\n    private AccountService accountService;\n    @Resource\n    private StorageService storageService;\n\n    /**\n     * \u521b\u5efa\u8ba2\u5355->\u8c03\u7528\u5e93\u5b58\u670d\u52a1\u6263\u51cf\u5e93\u5b58->\u8c03\u7528\u8d26\u6237\u670d\u52a1\u6263\u51cf\u8d26\u6237\u4f59\u989d->\u4fee\u6539\u8ba2\u5355\u72b6\u6001\n     * \u7b80\u5355\u8bf4:\n     * \u4e0b\u8ba2\u5355->\u51cf\u5e93\u5b58->\u51cf\u4f59\u989d->\u6539\u72b6\u6001\n     * GlobalTransactional seata\u5f00\u542f\u5206\u5e03\u5f0f\u4e8b\u52a1,\u5f02\u5e38\u65f6\u56de\u6eda,name\u4fdd\u8bc1\u552f\u4e00\u5373\u53ef\n     *\n     * @param order \u8ba2\u5355\u5bf9\u8c61\n     */\n    @Override\n    @GlobalTransactional(name = "fsp-create-order", rollbackFor = Exception.class)\n    public void create(Order order) {\n        // 1 \u65b0\u5efa\u8ba2\u5355\n        log.info("-----\x3e\u5f00\u59cb\u65b0\u5efa\u8ba2\u5355");\n        orderDao.create(order);\n\n        // 2 \u6263\u51cf\u5e93\u5b58\n        log.info("-----\x3e\u8ba2\u5355\u5fae\u670d\u52a1\u5f00\u59cb\u8c03\u7528\u5e93\u5b58,\u505a\u6263\u51cfCount");\n        storageService.decrease(order.getProductId(), order.getCount());\n        log.info("-----\x3e\u8ba2\u5355\u5fae\u670d\u52a1\u5f00\u59cb\u8c03\u7528\u5e93\u5b58,\u505a\u6263\u51cfEnd");\n\n        // 3 \u6263\u51cf\u8d26\u6237\n        log.info("-----\x3e\u8ba2\u5355\u5fae\u670d\u52a1\u5f00\u59cb\u8c03\u7528\u8d26\u6237,\u505a\u6263\u51cfMoney");\n        accountService.decrease(order.getUserId(), order.getMoney());\n        log.info("-----\x3e\u8ba2\u5355\u5fae\u670d\u52a1\u5f00\u59cb\u8c03\u7528\u8d26\u6237,\u505a\u6263\u51cfEnd");\n\n        // 4 \u4fee\u6539\u8ba2\u5355\u72b6\u6001,\u4ece0\u52301,1\u4ee3\u8868\u5df2\u5b8c\u6210\n        log.info("-----\x3e\u4fee\u6539\u8ba2\u5355\u72b6\u6001\u5f00\u59cb");\n        orderDao.update(order.getUserId(), 0);\n\n        log.info("-----\x3e\u4e0b\u8ba2\u5355\u7ed3\u675f\u4e86,O(\u2229_\u2229)O\u54c8\u54c8~");\n    }\n}\n')),Object(c.b)("h2",Object(a.a)({parentName:"blockquote"},{id:"\u6267\u884c\u4e1a\u52a1-1"}),"\u6267\u884c\u4e1a\u52a1"),Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},"\u8bbf\u95ee http://localhost:2001/order/create?userId=1&productId=1&count=10&money=100",Object(c.b)("ul",{parentName:"li"},Object(c.b)("li",{parentName:"ul"},"1 \u53f7\u7528\u6237\uff0c\u4e70 1 \u53f7\u4ea7\u54c1\uff0c\u4e70\u4e86 10 \u4e2a\uff0c\u82b1\u8d39 100 \u5757\u94b1"))),Object(c.b)("li",{parentName:"ul"},"\u6b64\u5904\u4f1a\u89e6\u53d1 OpenFeign \u8d85\u65f6\u5f02\u5e38"),Object(c.b)("li",{parentName:"ul"},"\u67e5\u770b\u6570\u636e\u5e93\u53d8\u5316")),Object(c.b)("blockquote",{parentName:"blockquote"},Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"seata_account -> t_account"),"\u8868")),Object(c.b)("table",{parentName:"blockquote"},Object(c.b)("thead",{parentName:"table"},Object(c.b)("tr",{parentName:"thead"},Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"user_id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"total"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"used"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"residue"))),Object(c.b)("tbody",{parentName:"table"},Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1000"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"200"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"800")))),Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"seata_order -> t_order")," \u8868")),Object(c.b)("table",{parentName:"blockquote"},Object(c.b)("thead",{parentName:"table"},Object(c.b)("tr",{parentName:"thead"},Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"user_id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"product_id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"count"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"money"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"status"))),Object(c.b)("tbody",{parentName:"table"},Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"7"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"10"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"100"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1")),Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"8"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"10"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"100"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"0")))),Object(c.b)("ul",{parentName:"blockquote"},Object(c.b)("li",{parentName:"ul"},Object(c.b)("inlineCode",{parentName:"li"},"seata_storage -> t_storage")," \u8868")),Object(c.b)("table",{parentName:"blockquote"},Object(c.b)("thead",{parentName:"table"},Object(c.b)("tr",{parentName:"thead"},Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"product_id"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"total"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"used"),Object(c.b)("th",Object(a.a)({parentName:"tr"},{align:"center"}),"residue"))),Object(c.b)("tbody",{parentName:"table"},Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"1"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"100"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"20"),Object(c.b)("td",Object(a.a)({parentName:"tr"},{align:"center"}),"80")))))),Object(c.b)("div",{className:"admonition admonition-info alert alert--info"},Object(c.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(c.b)("h5",{parentName:"div"},Object(c.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(c.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(c.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"\u7ed3\u679c")),Object(c.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(c.b)("p",{parentName:"div"},"\u6570\u636e\u6ca1\u6709\u4efb\u4f55\u53d8\u5316\uff0c\u8bf4\u660e\u89e6\u53d1\u8d85\u65f6\u5f02\u5e38\u540e\uff0c\u6240\u6709\u4e00\u9636\u6bb5\u63d0\u4ea4\u7684\u5206\u652f\u4e8b\u52a1\u90fd\u7edf\u4e00\u56de\u6eda\u4e86"))))}p.isMDXComponent=!0},561:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},c=Object.keys(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=r.a.createContext({}),s=function(e){var t=r.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=s(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,c=e.originalType,o=e.parentName,l=b(e,["components","mdxType","originalType","parentName"]),d=s(n),u=a,m=d["".concat(o,".").concat(u)]||d[u]||p[u]||c;return n?r.a.createElement(m,i(i({ref:t},l),{},{components:n})):r.a.createElement(m,i({ref:t},l))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var c=n.length,o=new Array(c);o[0]=u;var i={};for(var b in t)hasOwnProperty.call(t,b)&&(i[b]=t[b]);i.originalType=e,i.mdxType="string"==typeof e?e:a,o[1]=i;for(var l=2;l<c;l++)o[l]=n[l];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},562:function(e,t,n){"use strict";function a(e){var t,n,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=a(e[t]))&&(r&&(r+=" "),r+=n);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}t.a=function(){for(var e,t,n=0,r="";n<arguments.length;)(e=arguments[n++])&&(t=a(e))&&(r&&(r+=" "),r+=t);return r}},563:function(e,t,n){"use strict";var a=n(0);const r=Object(a.createContext)(void 0);t.a=r},564:function(e,t,n){"use strict";var a=n(0),r=n(563);t.a=function(){const e=Object(a.useContext)(r.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},565:function(e,t,n){"use strict";var a=n(0),r=n.n(a),c=n(564),o=n(562),i=n(47),b=n.n(i);const l=37,s=39;t.a=function(e){const{block:t,children:n,defaultValue:i,values:d,groupId:p}=e,{tabGroupChoices:u,setTabGroupChoices:m}=Object(c.a)(),[O,g]=Object(a.useState)(i),[j,N]=Object(a.useState)(!1);if(null!=p){const e=u[p];null!=e&&e!==O&&d.some(t=>t.value===e)&&g(e)}const v=e=>{g(e),null!=p&&m(p,e)},y=[],f=e=>{e.metaKey||e.altKey||e.ctrlKey||N(!0)},h=()=>{N(!1)};return Object(a.useEffect)(()=>{window.addEventListener("keydown",f),window.addEventListener("mousedown",h)},[]),r.a.createElement("div",null,r.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(o.a)("tabs",{"tabs--block":t})},d.map(({value:e,label:t})=>r.a.createElement("li",{role:"tab",tabIndex:0,"aria-selected":O===e,className:Object(o.a)("tabs__item",b.a.tabItem,{"tabs__item--active":O===e}),style:j?{}:{outline:"none"},key:e,ref:e=>y.push(e),onKeyDown:e=>{((e,t,n)=>{switch(n.keyCode){case s:((e,t)=>{const n=e.indexOf(t)+1;e[n]?e[n].focus():e[0].focus()})(e,t);break;case l:((e,t)=>{const n=e.indexOf(t)-1;e[n]?e[n].focus():e[e.length-1].focus()})(e,t)}})(y,e.target,e),f(e)},onFocus:()=>v(e),onClick:()=>{v(e),N(!1)},onPointerDown:()=>N(!1)},t))),r.a.createElement("div",{role:"tabpanel",className:"margin-vert--md"},a.Children.toArray(n).filter(e=>e.props.value===O)[0]))}},566:function(e,t,n){"use strict";var a=n(0),r=n.n(a);t.a=function(e){return r.a.createElement("div",null,e.children)}}}]);