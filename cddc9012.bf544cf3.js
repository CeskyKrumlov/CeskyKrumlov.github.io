(window.webpackJsonp=window.webpackJsonp||[]).push([[227],{281:function(e,a,n){"use strict";n.r(a),n.d(a,"frontMatter",(function(){return i})),n.d(a,"metadata",(function(){return r})),n.d(a,"rightToc",(function(){return c})),n.d(a,"default",(function(){return o}));var t=n(2),l=n(6),b=(n(0),n(336)),i={id:"1.hashmap",title:"HashMap\u8be6\u89e3",hide_title:!0},r={unversionedId:"javase/1.hashmap",id:"javase/1.hashmap",isDocsHomePage:!1,title:"HashMap\u8be6\u89e3",description:"HashMap",source:"@site/docs/javase/1.1hashmap.md",permalink:"/docs/javase/1.hashmap",sidebar:"someSidebar",previous:{title:"\u96c6\u5408",permalink:"/docs/javase/1.collections"},next:{title:"\u62bd\u8c61",permalink:"/docs/javase/2.abstract"}},c=[{value:"HashMap",id:"hashmap",children:[{value:"HashMap\u7684\u6240\u6709\u6784\u9020\u65b9\u6cd5",id:"hashmap\u7684\u6240\u6709\u6784\u9020\u65b9\u6cd5",children:[]},{value:"\u521d\u59cb\u5bb9\u91cf\u3001\u52a0\u8f7d\u56e0\u5b50\u4e0eHashMap\u5e95\u5c42\u7ed3\u6784",id:"\u521d\u59cb\u5bb9\u91cf\u3001\u52a0\u8f7d\u56e0\u5b50\u4e0ehashmap\u5e95\u5c42\u7ed3\u6784",children:[]},{value:"Hash\u51b2\u7a81",id:"hash\u51b2\u7a81",children:[]},{value:"put\u65b9\u6cd5\u7684\u6e90\u4ee3\u7801",id:"put\u65b9\u6cd5\u7684\u6e90\u4ee3\u7801",children:[{value:"\u521d\u59cb\u5bb9\u91cf",id:"\u521d\u59cb\u5bb9\u91cf",children:[]},{value:"\u6700\u5927\u5bb9\u91cf",id:"\u6700\u5927\u5bb9\u91cf",children:[]},{value:"\u52a0\u8f7d\u56e0\u5b50\u2014\u2014\u63a7\u5236\u6269\u5bb9\u9608\u503c",id:"\u52a0\u8f7d\u56e0\u5b50\u63a7\u5236\u6269\u5bb9\u9608\u503c",children:[]}]},{value:"\u600e\u4e48\u786e\u5b9aEntry\u5728\u6570\u7ec4\u4e2d\u7684\u4f4d\u7f6e\u2014\u2014hash()",id:"\u600e\u4e48\u786e\u5b9aentry\u5728\u6570\u7ec4\u4e2d\u7684\u4f4d\u7f6ehash",children:[{value:"hashmap\u80fd\u4e0d\u80fd\u5b58 key=null, value=null",id:"hashmap\u80fd\u4e0d\u80fd\u5b58-keynull-valuenull",children:[]}]},{value:"\u6269\u5bb9",id:"\u6269\u5bb9",children:[{value:"resize()\u65b9\u6cd5\u6e90\u7801",id:"resize\u65b9\u6cd5\u6e90\u7801",children:[]}]},{value:"JDK1.7\u94fe\u8868\u5934\u63d2\u6cd5\u6539\u4e3aJDK1.8\u94fe\u8868\u5c3e\u63d2\u6cd5",id:"jdk17\u94fe\u8868\u5934\u63d2\u6cd5\u6539\u4e3ajdk18\u94fe\u8868\u5c3e\u63d2\u6cd5",children:[]},{value:"JDK1.8\u5f15\u5165\u7ea2\u9ed1\u6811",id:"jdk18\u5f15\u5165\u7ea2\u9ed1\u6811",children:[]},{value:"HashMap \u548c Hashtable \u7684\u533a\u522b",id:"hashmap-\u548c-hashtable-\u7684\u533a\u522b",children:[]}]},{value:"ConcurrentHashMap",id:"concurrenthashmap",children:[{value:"JDK1.5 \u2014\u2014 Segment\u7ea7\u53ef\u91cd\u5165\u9501",id:"jdk15--segment\u7ea7\u53ef\u91cd\u5165\u9501",children:[]},{value:"JDK1.8\u2014\u2014\u94fe\u8868\u5934CAS+synchronized\u7ec6\u7c92\u5ea6\u9501",id:"jdk18\u94fe\u8868\u5934cassynchronized\u7ec6\u7c92\u5ea6\u9501",children:[]}]},{value:"\u9762\u8bd5\u9898",id:"\u9762\u8bd5\u9898",children:[]}],p={rightToc:c};function o(e){var a=e.components,i=Object(l.a)(e,["components"]);return Object(b.b)("wrapper",Object(t.a)({},p,i,{components:a,mdxType:"MDXLayout"}),Object(b.b)("h1",{id:"hashmap"},"HashMap"),Object(b.b)("p",null,Object(b.b)("a",Object(t.a)({parentName:"p"},{href:"https://blog.csdn.net/ljf199701/article/details/106309417/"}),"https://blog.csdn.net/ljf199701/article/details/106309417/")),Object(b.b)("blockquote",null,Object(b.b)("p",{parentName:"blockquote"},"\u67e5\u627e\u901f\u5ea6\u5feb\uff0c\u7406\u60f3\u60c5\u51b5\u4e0b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3aO(1)"),Object(b.b)("ul",{parentName:"blockquote"},Object(b.b)("li",{parentName:"ul"},"\u5728\u54c8\u5e0c\u8868\u4e2d\u63d2\u5165\u4e00\u4e2a\u5143\u7d20\u7684\u590d\u6742\u5ea6\u662fO(1)"),Object(b.b)("li",{parentName:"ul"},"\u5728\u65e0\u5e8f\u6570\u7ec4\u4e2d\u63d2\u5165\u4e00\u4e2a\u5143\u7d20\u7684\u590d\u6742\u5ea6\u662fO(1)"),Object(b.b)("li",{parentName:"ul"},"\u8bbf\u95ee\u6570\u7ec4\u4e2d\u7684\u7b2cn\u4e2a\u5143\u7d20\u7684\u590d\u6742\u5ea6\u662fO(1)"),Object(b.b)("li",{parentName:"ul"},"\u8bbf\u95ee\u94fe\u8868\u4e2d\u7684\u7b2cn\u4e2a\u5143\u7d20\u7684\u590d\u6742\u5ea6\u662fO(n)"))),Object(b.b)("h2",{id:"hashmap\u7684\u6240\u6709\u6784\u9020\u65b9\u6cd5"},"HashMap\u7684\u6240\u6709\u6784\u9020\u65b9\u6cd5"),Object(b.b)("table",null,Object(b.b)("thead",{parentName:"table"},Object(b.b)("tr",{parentName:"thead"},Object(b.b)("th",Object(t.a)({parentName:"tr"},{align:"left"}),"Constructor and Description"))),Object(b.b)("tbody",{parentName:"table"},Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(t.a)({parentName:"tr"},{align:"left"}),Object(b.b)("inlineCode",{parentName:"td"},"HashMap()"),Object(b.b)("br",null),"\u6784\u9020\u4e00\u4e2a\u7a7a\u7684 ",Object(b.b)("inlineCode",{parentName:"td"},"HashMap")," \uff0c\u9ed8\u8ba4\u521d\u59cb\u5bb9\u91cf\uff0816\uff09\u548c\u9ed8\u8ba4\u8d1f\u8f7d\u7cfb\u6570\uff080.75\uff09\u3002")),Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(t.a)({parentName:"tr"},{align:"left"}),Object(b.b)("inlineCode",{parentName:"td"},"HashMap(int initialCapacity)"),Object(b.b)("br",null),"\u6784\u9020\u4e00\u4e2a\u7a7a\u7684 ",Object(b.b)("inlineCode",{parentName:"td"},"HashMap"),"\u5177\u6709\u6307\u5b9a\u7684\u521d\u59cb\u5bb9\u91cf\u548c\u9ed8\u8ba4\u8d1f\u8f7d\u56e0\u5b50\uff080.75\uff09\u3002")),Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(t.a)({parentName:"tr"},{align:"left"}),Object(b.b)("inlineCode",{parentName:"td"},"HashMap(int initialCapacity, float loadFactor)"),Object(b.b)("br",null),"\u6784\u9020\u4e00\u4e2a\u7a7a\u7684 ",Object(b.b)("inlineCode",{parentName:"td"},"HashMap"),"\u5177\u6709\u6307\u5b9a\u7684\u521d\u59cb\u5bb9\u91cf\u548c\u8d1f\u8f7d\u56e0\u5b50\u3002")),Object(b.b)("tr",{parentName:"tbody"},Object(b.b)("td",Object(t.a)({parentName:"tr"},{align:"left"}),Object(b.b)("inlineCode",{parentName:"td"},"HashMap(Map<? extends K,? extends V> m)"),Object(b.b)("br",null),"\u6784\u9020\u4e00\u4e2a\u65b0\u7684 ",Object(b.b)("inlineCode",{parentName:"td"},"HashMap"),"\u4e0e\u6307\u5b9a\u7684\u76f8\u540c\u7684\u6620\u5c04 ",Object(b.b)("inlineCode",{parentName:"td"},"Map")," \u3002")))),Object(b.b)("h2",{id:"\u521d\u59cb\u5bb9\u91cf\u3001\u52a0\u8f7d\u56e0\u5b50\u4e0ehashmap\u5e95\u5c42\u7ed3\u6784"},"\u521d\u59cb\u5bb9\u91cf\u3001\u52a0\u8f7d\u56e0\u5b50\u4e0eHashMap\u5e95\u5c42\u7ed3\u6784"),Object(b.b)("blockquote",null,Object(b.b)("ul",{parentName:"blockquote"},Object(b.b)("li",{parentName:"ul"},Object(b.b)("p",{parentName:"li"},"\u5bb9\u91cf\u6709\u4ec0\u4e48\u4f5c\u7528\uff0c\u52a0\u8f7d\u56e0\u5b50\u6709\u4ec0\u4e48\u4f5c\u7528\uff1f")),Object(b.b)("li",{parentName:"ul"},Object(b.b)("p",{parentName:"li"},"\u4ec0\u4e48\u65f6\u5019\u521b\u5efa\uff1f")),Object(b.b)("li",{parentName:"ul"},Object(b.b)("p",{parentName:"li"},"\u6570\u7ec4\u7684\u4f5c\u7528\u3001\u94fe\u8868\u7684\u4f5c\u7528"),Object(b.b)("ul",{parentName:"li"},Object(b.b)("li",{parentName:"ul"},"Java\u4e2d\u5b58\u50a8\u6570\u636e\u90fd\u9700\u8981\u5bb9\u5668"))),Object(b.b)("li",{parentName:"ul"},Object(b.b)("p",{parentName:"li"},"\u4ec0\u4e48\u65f6\u5019\u521b\u5efa\u6570\u7ec4\uff0c\u4ec0\u4e48\u65f6\u5019\u5f62\u6210\u94fe\u8868"),Object(b.b)("ul",{parentName:"li"},Object(b.b)("li",{parentName:"ul"},"\u5e76\u4e0d\u662f\u5728\u6784\u9020\u65b9\u6cd5\u5185\u521b\u5efa\u7684"),Object(b.b)("li",{parentName:"ul"},"\u5b9e\u5728",Object(b.b)("inlineCode",{parentName:"li"},"put"),"\u65b9\u6cd5\u4e2d\u521b\u5efa\u7684"),Object(b.b)("li",{parentName:"ul"},"\u4e3a\u4ec0\u4e48\u8981\u5728",Object(b.b)("inlineCode",{parentName:"li"},"put"),"\u4e2d\u521b\u5efa",Object(b.b)("ul",{parentName:"li"},Object(b.b)("li",{parentName:"ul"},"\u6570\u7ec4\u5728\u5185\u5b58\u4e2d\u662f\u4e00\u6bb5\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5982\u679c\u521b\u5efa\u4e86hashmap\u7533\u8bf7\u4e86\u7a7a\u95f4\uff0c\u4f46\u662f\u4ec0\u4e48\u90fd\u4e0d\u653e\uff0c\u90a3\u5c31\u767d\u767d\u6d6a\u8d39\u4e86\u7a7a\u95f4\uff0c\u6240\u4ee5\u5728",Object(b.b)("inlineCode",{parentName:"li"},"put"),"\u65f6\u624d\u5f00\u8f9f\u7a7a\u95f4"))))),Object(b.b)("li",{parentName:"ul"},Object(b.b)("p",{parentName:"li"},"\u600e\u4e48\u786e\u5b9a\u952e\u503c\u5bf9Entry\u5728\u6570\u7ec4\u4e2d\u7684\u4f4d\u7f6e")),Object(b.b)("li",{parentName:"ul"},Object(b.b)("p",{parentName:"li"},"Entry\u952e\u503c\u5bf9\u5728\u6570\u7ec4\u4e2d\u7684\u4f4d\u7f6e\u91cd\u590d\u4e86\u600e\u4e48\u529e"),Object(b.b)("ul",{parentName:"li"},Object(b.b)("li",{parentName:"ul"},"\u5982\u679c\u5b58\u653e\u7684\u952e\u503c\u5bf9\u5728\u6570\u7ec4\u4e2d\u4f4d\u7f6e\u76f8\u540c\uff0c\u79f0\u4e3aHash\u51b2\u7a81"))),Object(b.b)("li",{parentName:"ul"},Object(b.b)("p",{parentName:"li"},"\u5982\u679c\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e00\u4e2a\u4f4d\u7f6e\u4e0a\u90fd\u5df2\u7ecf\u6709Entry\u4e86\u600e\u4e48\u529e\uff1f\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f"),Object(b.b)("ul",{parentName:"li"},Object(b.b)("li",{parentName:"ul"},"\u4f1a\u9891\u7e41\u7684\u6784\u6210\u94fe\u8868"),Object(b.b)("li",{parentName:"ul"},Object(b.b)("strong",{parentName:"li"},"\u56e0\u6b64\u63d0\u51fa\u4e86\u5bf9\u6570\u7ec4\u8fdb\u884c",Object(b.b)("inlineCode",{parentName:"strong"},"\u6269\u5bb9"))),Object(b.b)("li",{parentName:"ul"},"\u5f53\u5df2\u4f7f\u7528\u7684\u6570\u7ec4\u5bb9\u91cf\u8d85\u8fc7 $ \u521d\u59cb\u5bb9\u91cf \\times \u52a0\u8f7d\u56e0\u5b50 $ \uff0c \u9ed8\u8ba4 $16\\times0.75=12$\u65f6\uff0c\u5bf9\u6570\u7ec4\u8fdb\u884c\u6269\u5bb9"))))),Object(b.b)("ul",null,Object(b.b)("li",{parentName:"ul"},Object(b.b)("strong",{parentName:"li"},"HashMap\u7684\u65e0\u53c2\u6784\u9020\u65b9\u6cd5\u6e90\u4ee3\u7801"))),Object(b.b)("pre",null,Object(b.b)("code",Object(t.a)({parentName:"pre"},{className:"language-java"}),"/**\n     * Constructs an empty <tt>HashMap</tt> with the default initial capacity\n     * (16) and the default load factor (0.75).\n     */\npublic HashMap() {\n  this.loadFactor = DEFAULT_LOAD_FACTOR; // all other fields defaulted\n}\n")),Object(b.b)("p",null,"\u53ef\u4ee5\u770b\u5230\u5c06",Object(b.b)("strong",{parentName:"p"},"\u8d1f\u8f7d\u56e0\u5b50"),"\u8bbe\u7f6e\u4e3a\u4e86\u9ed8\u8ba4\u8d1f\u8f7d\u56e0\u5b50\u503c\uff0c\u5e76\u6ca1\u6709\u521b\u5efa\u4efb\u4f55\u6570\u7ec4\u6216\u94fe\u8868"),Object(b.b)("p",null,Object(b.b)("img",{alt:"image-20200626135521059",src:n(633).default})),Object(b.b)("h2",{id:"hash\u51b2\u7a81"},"Hash\u51b2\u7a81"),Object(b.b)("blockquote",null,Object(b.b)("ul",{parentName:"blockquote"},Object(b.b)("li",{parentName:"ul"},"\u5982\u679c\u5b58\u653e\u7684\u952e\u503c\u5bf9",Object(b.b)("strong",{parentName:"li"},"\u5728\u6570\u7ec4\u4e2d\u4f4d\u7f6e\u76f8\u540c"),"\uff0c\u79f0\u4e3aHash\u51b2\u7a81"),Object(b.b)("li",{parentName:"ul"},"\u5219\uff0c\u5728\u5bf9\u5e94\u6570\u7ec4\u4f4d\u7f6e\u4e0a\uff0c\u5c06\u91cd\u590dEntry\u5bf9\u8c61\u5c01\u88c5\u4e3a\u4e00\u4e2a\u94fe\u8868"),Object(b.b)("li",{parentName:"ul"},"\u5982\u679c\u8fd9\u4e2a\u94fe\u8868\u592a\u957f\u4e86\uff0c\u641c\u7d22\u6548\u7387\u5c31\u4f1a\u56e0\u4e3a\u94fe\u8868\u8fd9\u79cd\u7ed3\u6784\u800c\u4e0b\u964d"),Object(b.b)("li",{parentName:"ul"},"\u9ed8\u8ba4\uff0c\u94fe\u8868\u957f\u8fbe\u5927\u4e8e8\uff0c\u4e14\u6570\u7ec4\u957f\u5ea6\u5927\u4e8e64\uff0c\u8f6c\u7ea2\u9ed1\u6811"))),Object(b.b)("h2",{id:"put\u65b9\u6cd5\u7684\u6e90\u4ee3\u7801"},"put\u65b9\u6cd5\u7684\u6e90\u4ee3\u7801"),Object(b.b)("blockquote",null,Object(b.b)("p",{parentName:"blockquote"},"\u5411HashMap\u4e2d\u5b58\u653e\u6570\u636e\uff0c\u9700\u8981\u8ba1\u7b97Hash\u503c\uff0c\u8ba1\u7b97\u952e\u503c\u5bf9\u5728\u6570\u7ec4\u4e2d\u7684\u4f4d\u7f6e\uff0c\u51b3\u5b9a\u662f\u5426\u8981\u8fdb\u884c\u6269\u5bb9\uff0c\u5e76\u4e14HashMap\u7684\u6570\u7ec4\u5b9e\u9645\u4e0a\u662f\u5728put\u65b9\u6cd5\u9636\u6bb5\u88ab\u521b\u5efa\u7684")),Object(b.b)("pre",null,Object(b.b)("code",Object(t.a)({parentName:"pre"},{className:"language-java"}),"public V put(K key, V value) {\n  return putVal(hash(key), key, value, false, true);\n}\n")),Object(b.b)("ul",null,Object(b.b)("li",{parentName:"ul"},"\u8c03\u7528\u4e86",Object(b.b)("inlineCode",{parentName:"li"},"putVal()")),Object(b.b)("li",{parentName:"ul"},Object(b.b)("inlineCode",{parentName:"li"},"putVal()"),"\u8c03\u7528\u4e86",Object(b.b)("inlineCode",{parentName:"li"},"hash()"),"\u54c8\u5e0c\u65b9\u6cd5 ","[",Object(b.b)("strong",{parentName:"li"},"\u7528\u4e8e\u786e\u5b9aEntry\u5728\u6570\u7ec4\u4e2d\u7684\u4f4d\u7f6e\uff0c\u5177\u4f53\u8bf7\u770b\u300a\u600e\u4e48\u786e\u5b9aEntry\u5728\u6570\u7ec4\u4e2d\u5b9a\u4f4d\u7f6e\u300b"),"]","\uff0c\u54c8\u5e0c\u65b9\u6cd5\u8fd4\u56de\u4e86\u4e00\u4e2a",Object(b.b)("inlineCode",{parentName:"li"},"int"),"\u503c"),Object(b.b)("li",{parentName:"ul"},"\u5224\u65ad\u6570\u7ec4\u662f\u5426\u5b58\u5728or\u6570\u7ec4\u957f\u5ea6\u4e3a0\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u6216\u957f\u5ea6\u4e3a0\u5c31\u8c03\u7528",Object(b.b)("inlineCode",{parentName:"li"},"resize()"),"\u6839\u636e\u521d\u59cb\u5bb9\u91cf\u5f97\u5230\u4e00\u4e2a\u6570\u7ec4\u5bf9\u8c61\uff0c\u5e76\u5c06\u5176\u957f\u5ea6\u8d4b\u7ed9n"),Object(b.b)("li",{parentName:"ul"},"\u4f7f\u7528\u6570\u7ec4\u6700\u5927\u4e0b\u6807(n-1)\u4f5c\u4e3a\u4f4e\u4f4d\u63a9\u7801\u53d6hash\u4f4e\u4f4d\u4f5c\u4e3a\u6570\u7ec4\u4e0b\u6807"),Object(b.b)("li",{parentName:"ul"},"\u5224\u65ad\u6570\u7ec4\u5bf9\u5e94\u4e0b\u6807\u4f4d\u7f6e\u4e0a\u6709\u6ca1\u6709Entry\u5143\u7d20\uff0c\u53ef\u80fd\u51fa\u73b0\u4e09\u79cd\u60c5\u51b5",Object(b.b)("ol",{parentName:"li"},Object(b.b)("li",{parentName:"ol"},"\u4f4d\u7f6e\u4e0a\u5565\u4e5f\u6ca1\u6709\uff0c\u662f\u4e2anull\uff0c\u76f4\u63a5newNode\uff0c\u521b\u5efa\u4e00\u4e2aEntry\u8282\u70b9\u653e\u8fdb\u53bb"),Object(b.b)("li",{parentName:"ol"},"\u4f4d\u7f6e\u4e0a\u6709\u4e2aEntry\uff0c\u8981\u6d89\u53ca\u94fe\u8868\u64cd\u4f5c"),Object(b.b)("li",{parentName:"ol"},"\u4f4d\u7f6e\u4e0a\u662f\u4e2a\u7ea2\u9ed1\u6811\uff0c\u6d89\u53ca\u5230\u5e73\u8861\u4e8c\u53c9\u6811\u64cd\u4f5c")))),Object(b.b)("pre",null,Object(b.b)("code",Object(t.a)({parentName:"pre"},{className:"language-java"}),"/**\n     * Implements Map.put and related methods.\n     *\n     * @param hash hash for key\n     * @param key the key\n     * @param value the value to put\n     * @param onlyIfAbsent if true, don't change existing value\n     * @param evict if false, the table is in creation mode.\n     * @return previous value, or null if none\n     */\nfinal V putVal(int hash, K key, V value, boolean onlyIfAbsent,\n               boolean evict) {\n  //\u5b9a\u4e49\u4e00\u4e2a\u8282\u70b9\u6570\u7ec4\uff0c\u4e00\u4e2a\u8282\u70b9\n  Node<K,V>[] tab; Node<K,V> p; int n, i;\n  //\u5c06\u5f53\u524d\u6570\u7ec4\u8d4b\u7ed9\u5c40\u90e8\u6570\u7ec4\uff0c\u5224\u65ad\u6709\u6ca1\u6709\u521b\u5efa\u8fc7\u6570\u7ec4 or \u6570\u7ec4\u7684\u957f\u5ea6\u4e3a0\n  if ((tab = table) == null || (n = tab.length) == 0)\n    n = (tab = resize()).length;        // resize()\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a\u6570\u7ec4\u5bf9\u8c61\uff0c\u5c06\u6570\u7ec4\u957f\u5ea6\u8d4b\u7ed9n\uff0c\u9ed8\u8ba416\n  //\u51c6\u5907\u5c06Entry\u5bf9\u8c61\u653e\u5165\u6570\u7ec4\n  //n\u9ed8\u8ba416\uff0c-1\u4e8c\u8fdb\u5236\u4f4d1111,\u505a\u4e0e\u4f4d\u8fd0\u7b97\uff0c\u53d6hash\u4f4e\u56db\u4f4d\u3002\u6b63\u597d\u5728n\u8868\u793a\u7684\u957f\u5ea6\u8303\u56f4\u5185\uff0c\u5373\u4f5c\u4e3a\u4e0b\u6807\n  //\u5224\u65ad\u8ba1\u7b97\u51fa\u6765\u7684\u4e0b\u6807\u4f4d\u7f6e\u4e0a\u662f\u5426\u5df2\u5b58\u5728Entry\uff0c\u628a\u4e0b\u6807\u4e0a\u7684\u4e1c\u897f\u53d6\u51fa\u6765\u8d4b\u7ed9p\u8282\u70b9\n  if ((p = tab[i = (n - 1) & hash]) == null) // \u5982\u679c\u4f4d\u7f6e\u4e0a\u6ca1\u4e1c\u897f\uff0c\u76f4\u63a5\u65b0\u5efa\u4e00\u4e2aEntry\u8282\u70b9\u5b58\u8fdb\u53bb\n    tab[i] = newNode(hash, key, value, null);\n  else { //\u4f4d\u7f6e\u4e0a\u6709\u4e1c\u897f\uff0c\u63a5\u4e0b\u6765\u770b\u662f\u8d70\u94fe\u8868\u8fd8\u662f\u8d70\u7ea2\u9ed1\u6811\n    Node<K,V> e; K k;\n    if (p.hash == hash && // ==\u6bd4\u8f83\u7684\u662f\u5730\u5740\u503c\u662f\u5426\u76f8\u7b49\uff1bequals\u65b9\u6cd5\u6bd4\u8f83\u53ef\u4ee5\u81ea\u5b9a\u4e49\uff0c\u6bd4\u5982\u6309\u503c\u6bd4\u8f83\n        ((k = p.key) == key || (key != null && key.equals(k)))) //\u5982\u679ckey\u5b8c\u5168\u76f8\u540c\n      e = p; //\u5c06\u5f53\u524d\u4e0b\u6807\u4e0a\u7684\u8282\u70b9\u8d4b\u7ed9e \u56e0\u4e3aHashMap key\u552f\u4e00\n    else if (p instanceof TreeNode) //\u5224\u65ad\u5f53\u524d\u4e0b\u6807\u4e0a\u7684\u4e1c\u897f\u662f\u4e0d\u662f\u6811\u8282\u70b9\uff0c\u5373\u5224\u65ad\u662f\u94fe\u8868\u8fd8\u662f\u7ea2\u9ed1\u6811\n      e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value); //\u5c06\u8282\u70b9\u653e\u5230\u7ea2\u9ed1\u6811\u4e0a\n    else { //\u5f53\u524d\u4e0b\u6807\u4e0a\u7684\u4e1c\u897f\u662f\u4e2a\u94fe\u8868\n      for (int binCount = 0; ; ++binCount) { //\u904d\u5386\u94fe\u8868\n        if ((e = p.next) == null) { //\u627e\u5230\u94fe\u8868\u5c3e\n          p.next = newNode(hash, key, value, null); //\u5c3e\u63d2\u65b0\u8282\u70b9 \n          // \u5982\u679c\u94fe\u8868\u957f\u5ea6\u5927\u4e8e\u6811\u9608\u503c-1\uff0c\u8f6c\u7ea2\u9ed1\u6811\n          // \u8f6c\u7ea2\u9ed1\u6811\u7684treeifyBin\u65b9()\u6cd5\uff0c\u8981\u5224\u65ad\u6570\u7ec4\u957f\u5ea6\u662f\u5426\u5c0f\u4e8e MIN_TREEIFY_CAPACITY\uff0c\u5982\u679c\u6bd4\u6700\u5c0f\u6811\u5bb9\u91cf\u5c0f\uff0c\u5c31\u8c03\u7528resize()\uff0c\u4e0d\u8f6c\u7ea2\u9ed1\u6811;\n          if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st   \n            treeifyBin(tab, hash);\n          break;\n        }\n        if (e.hash == hash &&\n            ((k = e.key) == key || (key != null && key.equals(k))))\n          break; //\u5982\u679ckey\u548c\u94fe\u8868\u4e0a\u67d0\u4e2a\u8282\u70b9\u7684key\u4e00\u6a21\u4e00\u6837\u5219\u5565\u4e5f\u4e0d\u505a\u76f4\u63a5\u8df3\u51fa\u94fe\u8868\u904d\u5386\n        p = e;  //\u8fed\u4ee3\u94fe\u8868\u7684\u4e0b\u4e00\u4e2a\u8282\u70b9\n      }\n    }\n    if (e != null) { // existing mapping for key\n      V oldValue = e.value;  // \u53d6\u51fae\u7684value\uff0c\u5373\u65e7\u503c\n      if (!onlyIfAbsent || oldValue == null)\n        e.value = value;  // \u76f4\u63a5\u8986\u76d6\u65e7\u503c\uff0c\u628a\u65b0\u503c\u5b58\u5230\u5f53\u524dkey\u91cc\n      afterNodeAccess(e);  // \u8bbf\u95ee\u540e\u56de\u8c03\n      return oldValue;  // HashMap.put()\u65b9\u6cd5\u8fd4\u56de\u88ab\u8986\u76d6\u6389\u7684\u65e7\u503c\n    }\n  }\n  ++modCount; //\u5f88\u591a\u96c6\u5408\u7c7b\u90fd\u6709\u8fd9\u4e2a\u5c5e\u6027\uff0c\u8bb0\u5f55\u7ed3\u6784\u5316\u4fee\u6539\u6b21\u6570\uff0c\u4e3b\u8981\u662f\u5173\u4e8e\u7ebf\u7a0b\u5b89\u5168\u7684\u3002\n  //\u5177\u4f53\u770b https://blog.csdn.net/u012926924/article/details/50452411\n  if (++size > threshold) // \u5224\u65ad\u662f\u5426\u9700\u8981\u6269\u5bb9\n    resize();\n  afterNodeInsertion(evict); \n  return null;\n}\n")),Object(b.b)("ul",null,Object(b.b)("li",{parentName:"ul"},Object(b.b)("strong",{parentName:"li"},"tab\u8282\u70b9\u6570\u7ec4"),Object(b.b)("ul",{parentName:"li"},Object(b.b)("li",{parentName:"ul"},Object(b.b)("inlineCode",{parentName:"li"},"transient"),"\u8868\u793a\u4e34\u65f6\uff0c\u4e3b\u8981\u6d89\u53ca\u5230Java\u5e8f\u5217\u5316\u548c\u5b89\u5168\u6027\uff0c\u4f7f\u7528\u540e\u53d8\u91cf\u4e0d\u4f1a\u88ab\u6301\u4e45\u5316\uff0c\u5173\u4e8e\u5b83\u7684\u5177\u4f53\u5185\u5bb9\u8bf7\u770b",Object(b.b)("a",Object(t.a)({parentName:"li"},{href:"https://www.cnblogs.com/lanxuezaipiao/p/3369962.html"}),"transient\u5173\u952e\u5b57\u8be6\u89e3"))))),Object(b.b)("pre",null,Object(b.b)("code",Object(t.a)({parentName:"pre"},{className:"language-java"}),"/**\n     * The table, initialized on first use, and resized as\n     * necessary. When allocated, length is always a power of two.\n     * (We also tolerate length zero in some operations to allow\n     * bootstrapping mechanics that are currently not needed.)\n     */\ntransient Node<K,V>[] table;\n")),Object(b.b)("ul",null,Object(b.b)("li",{parentName:"ul"},"\u7528\u4e8e\u8f6c\u7ea2\u9ed1\u6811\u7684treeifyBin()\u65b9\u6cd5")),Object(b.b)("pre",null,Object(b.b)("code",Object(t.a)({parentName:"pre"},{className:"language-java"}),"/**\n     * Replaces all linked nodes in bin at index for given hash unless\n     * table is too small, in which case resizes instead.\n     */\nfinal void treeifyBin(Node<K,V>[] tab, int hash) {\n  int n, index; Node<K,V> e;\n  if (tab == null || (n = tab.length) < MIN_TREEIFY_CAPACITY) //\u5224\u65ad\u6570\u7ec4\u957f\u5ea6\u662f\u5426\u5c0f\u4e8e\u6700\u5c0f\u6811\u5bb9\u91cf64\n    resize(); //\u5c0f\u4e8e64\u5219\u4e0d\u8f6c\u7ea2\u9ed1\u6811\uff0c\u800c\u662f\u7528resize()\u6269\u5bb9\n  else if ((e = tab[index = (n - 1) & hash]) != null) {\n    TreeNode<K,V> hd = null, tl = null;\n    do {\n      TreeNode<K,V> p = replacementTreeNode(e, null);\n      if (tl == null)\n        hd = p;\n      else {\n        p.prev = tl;\n        tl.next = p;\n      }\n      tl = p;\n    } while ((e = e.next) != null);\n    if ((tab[index] = hd) != null)\n      hd.treeify(tab);\n  }\n}\n")),Object(b.b)("ul",null,Object(b.b)("li",{parentName:"ul"},"\u5982\u679ckey\u51b2\u7a81\uff0cput\u65b9\u6cd5\u8fd4\u56de\u88ab\u8986\u76d6\u7684\u65e7\u503c")),Object(b.b)("pre",null,Object(b.b)("code",Object(t.a)({parentName:"pre"},{className:"language-java"}),'public static void main(String[] args) {\n    HashMap<Object, Object> map = new HashMap<>();\n    map.put(1, "1");\n    Object put = map.put(1, "2");\n    System.out.println(put);\n}\n')),Object(b.b)("pre",null,Object(b.b)("code",Object(t.a)({parentName:"pre"},{}),"1\n")),Object(b.b)("h3",{id:"\u521d\u59cb\u5bb9\u91cf"},"\u521d\u59cb\u5bb9\u91cf"),Object(b.b)("blockquote",null,Object(b.b)("p",{parentName:"blockquote"},"\u6e90\u4ee3\u7801")),Object(b.b)("pre",null,Object(b.b)("code",Object(t.a)({parentName:"pre"},{className:"language-java"}),"/**\n  * The default initial capacity - MUST be a power of two.\n  */\nstatic final int DEFAULT_INITIAL_CAPACITY = 1 << 4; // aka 16\n")),Object(b.b)("ul",null,Object(b.b)("li",{parentName:"ul"},"\u4f7f\u7528\u4f4d\u64cd\u4f5c\u5b9a\u4e49\uff0c\u4e8c\u8fdb\u5236",Object(b.b)("inlineCode",{parentName:"li"},"0001")," \u5de6\u79fb4\u4e0b\uff0c \u53d8\u4e3a\u4e8c\u8fdb\u5236",Object(b.b)("inlineCode",{parentName:"li"},"0001 0000")," \u7b49\u4e8e\u5341\u8fdb\u523616"),Object(b.b)("li",{parentName:"ul"},"\u6ce8\u91ca\u4e2d\u5199\u5230\uff0c\u521d\u59cb\u5bb9\u91cf\u5fc5\u987b\u4e3a",Object(b.b)("inlineCode",{parentName:"li"},"2\u7684\u5e42"))),Object(b.b)("h3",{id:"\u6700\u5927\u5bb9\u91cf"},"\u6700\u5927\u5bb9\u91cf"),Object(b.b)("pre",null,Object(b.b)("code",Object(t.a)({parentName:"pre"},{className:"language-java"}),"/**\n * The maximum capacity, used if a higher value is implicitly specified\n * by either of the constructors with arguments.\n * MUST be a power of two <= 1<<30.\n */\nstatic final int MAXIMUM_CAPACITY = 1 << 30;\n")),Object(b.b)("ul",null,Object(b.b)("li",{parentName:"ul"},"\u6700\u5927\u5bb9\u91cf\u4e3a$2^{30}$"),Object(b.b)("li",{parentName:"ul"},"\u5fc5\u987b\u4e3a\u5c0f\u4e8e$2^{30}$\u7684\u4e00\u4e2a2\u7684\u5e42")),Object(b.b)("h3",{id:"\u52a0\u8f7d\u56e0\u5b50\u63a7\u5236\u6269\u5bb9\u9608\u503c"},"\u52a0\u8f7d\u56e0\u5b50\u2014\u2014\u63a7\u5236\u6269\u5bb9\u9608\u503c"),Object(b.b)("pre",null,Object(b.b)("code",Object(t.a)({parentName:"pre"},{className:"language-java"}),"/**\n     * The load factor used when none specified in constructor.\n     */\nstatic final float DEFAULT_LOAD_FACTOR = 0.75f;\n")),Object(b.b)("h2",{id:"\u600e\u4e48\u786e\u5b9aentry\u5728\u6570\u7ec4\u4e2d\u7684\u4f4d\u7f6ehash"},"\u600e\u4e48\u786e\u5b9aEntry\u5728\u6570\u7ec4\u4e2d\u7684\u4f4d\u7f6e\u2014\u2014hash()"),Object(b.b)("pre",null,Object(b.b)("code",Object(t.a)({parentName:"pre"},{className:"language-java"}),"/**\n     * Computes key.hashCode() and spreads (XORs) higher bits of hash\n     * to lower.  Because the table uses power-of-two masking, sets of\n     * hashes that vary only in bits above the current mask will\n     * always collide. (Among known examples are sets of Float keys\n     * holding consecutive whole numbers in small tables.)  So we\n     * apply a transform that spreads the impact of higher bits\n     * downward. There is a tradeoff between speed, utility, and\n     * quality of bit-spreading. Because many common sets of hashes\n     * are already reasonably distributed (so don't benefit from\n     * spreading), and because we use trees to handle large sets of\n     * collisions in bins, we just XOR some shifted bits in the\n     * cheapest possible way to reduce systematic lossage, as well as\n     * to incorporate impact of the highest bits that would otherwise\n     * never be used in index calculations because of table bounds.\n     */\nstatic final int hash(Object key) {\n  int h;\n  return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);\n}\n")),Object(b.b)("ul",null,Object(b.b)("li",{parentName:"ul"},"\u5982\u679c",Object(b.b)("inlineCode",{parentName:"li"},"key"),"\u4e3a",Object(b.b)("inlineCode",{parentName:"li"},"null"),"\uff0c\u5219\u76f4\u63a5\u5c06hash\u503c\u8bbe\u5b9a\u4e3a",Object(b.b)("inlineCode",{parentName:"li"},"0")),Object(b.b)("li",{parentName:"ul"},"\u5426\u5219\u8ba1\u7b97hash code\uff0c\u8c03\u7528\u7684\u662fObject\u7684hashCode\u65b9\u6cd5\uff0c\u8ba1\u7b97\u5b8c\u540e\u60f3\u6709\u65e0\u7b26\u53f7\u79fb\u52a816\u4f4d\uff0c\u5e76\u4e14\u53d6\u9ad8\u4f4d -> \u518d\u548c\u539f\u59cbhash\u8fdb\u884c\u5f02\u6216\u8fd0\u7b97\uff0c\u8fd4\u56de\u4e00\u4e2a",Object(b.b)("inlineCode",{parentName:"li"},"int"),"\u503c"),Object(b.b)("li",{parentName:"ul"},Object(b.b)("strong",{parentName:"li"},"\u8fd9\u6bb5\u8ba1\u7b97Hash code\u7684\u4ee3\u7801\u4e3a\u7684\u662f\u5b9e\u73b0 ",Object(b.b)("inlineCode",{parentName:"strong"},"\u6270\u52a8\u51fd\u6570"),"\uff0c\u964d\u4f4e\u78b0\u649e\u51e0\u7387\u3002\u5177\u4f53\u8bf7\u770b"),Object(b.b)("a",Object(t.a)({parentName:"li"},{href:"https://www.zhihu.com/question/20733617"}),"[JDK1.8\u4e2dHashMap\u4e2d\u7684hash\u65b9\u6cd5\u7684\u5e95\u5c42\u539f\u7406\u662f\u4ec0\u4e48]")),Object(b.b)("li",{parentName:"ul"},Object(b.b)("strong",{parentName:"li"},"\u8fd4\u56de\u7684\u5e76\u4e0d\u662fentry\u5728\u6570\u7ec4\u4e2d\u7684\u4e0b\u6807\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u65b9\u6cd5\u5e76\u4e0d\u77e5\u9053\u6570\u7ec4\u7684\u5177\u4f53\u957f\u5ea6")),Object(b.b)("li",{parentName:"ul"},"\u6700\u7ec8\u786e\u5b9a\u4f4d\u7f6e\u8981\u770b",Object(b.b)("inlineCode",{parentName:"li"},"put()"),"\u65b9\u6cd5\uff0c\u5177\u4f53\u8bf7\u770bput\u65b9\u6cd5\uff0c\u7ed3\u8bba\u4e3a\uff1a ",Object(b.b)("strong",{parentName:"li"},"\u4f7f\u7528\u6570\u7ec4\u7684\u603b\u957f\u5ea6n\uff0c\u51cf\u53bb1\uff0c\u5373n-1\u5373\u6570\u7ec4\u7684\u6700\u5927\u4e0b\u6807\uff0c\u4e0ehash\u503c\u505a\u6309\u4f4d\u4e0e\u8fd0\u7b97\u5f97\u5230\u4e0b\u6807")," $(n-1) \\& hash$"),Object(b.b)("li",{parentName:"ul"},"\u8fd9\u4e5f\u6b63\u597d\u89e3\u91ca\u4e86\u4e3a\u4ec0\u4e48HashMap\u7684\u6570\u7ec4\u957f\u5ea6\u8981\u53d6",Object(b.b)("inlineCode",{parentName:"li"},"2\u7684\u6574\u6b21\u5e42"),"\u3002\u56e0\u4e3a\u8fd9\u6837\uff08\u6570\u7ec4\u957f\u5ea6-1\uff09\u6b63\u597d\u76f8\u5f53\u4e8e\u4e00\u4e2a\u201c",Object(b.b)("strong",{parentName:"li"},"\u4f4e\u4f4d\u63a9\u7801\u201d\u3002"),Object(b.b)("ul",{parentName:"li"},Object(b.b)("li",{parentName:"ul"},"2\u7684\u6b21\u5e42\u7528\u4e8c\u8fdb\u5236\u4e66\u5199\u7684\u8bdd\uff0c\u5f62\u5f0f\u4e3a ",Object(b.b)("inlineCode",{parentName:"li"},"0000 0001"),"\u3001",Object(b.b)("inlineCode",{parentName:"li"},"0000 0010"),"\u3001",Object(b.b)("inlineCode",{parentName:"li"},"0000 0100"),"\u8fd9\u6837\u7684one-hot\u7f16\u7801\uff0c\u5373\u603b\u662f\u53ea\u6709\u4e00\u4f4d\u4e3a1\uff0c\u5269\u4e0b\u5168\u4e3a0"),Object(b.b)("li",{parentName:"ul"},"2\u7684\u6b21\u5e42\u7684\u4e8c\u8fdb\u5236\u8868\u793a\uff0c\u53ea\u8981-1\uff0c\u5c31\u4f1a\u53d8\u4e3a",Object(b.b)("inlineCode",{parentName:"li"},"0000 0000"),"\u3001",Object(b.b)("inlineCode",{parentName:"li"},"0000 0001"),"\u3001",Object(b.b)("inlineCode",{parentName:"li"},"0000 0011"),"\uff0c\u8fd9\u6837\u7684\u7f16\u7801\uff0c\u4ece\u9ad8\u4f4d\u5168\u4e3a0\uff0c\u4ece\u67d0\u4e00\u4f4d\u5f00\u59cb\u5168\u53d8\u62101"),Object(b.b)("li",{parentName:"ul"},"\u5f53\u4e00\u4e2a\u503c\u7528\u4e8c\u8fdb\u5236\u8868\u793a\u65f6\uff0c\u503c\u7684\u53d8\u5316\u66f4\u591a\u7684\u4f1a\u53cd\u6620\u5728\u4e8c\u8fdb\u5236\u4f4e\u4f4d\u4e0a\u7684\u53d8\u5316\uff0c\u9ad8\u4f4d\u53d8\u5316\u6bd4\u8f83\u5c11\uff0c\u56e0\u4e3a\u9ad8\u4f4d\u4ee3\u8868\u7684\u503c\u5f88\u5927\uff0c\u7b2c\u56db\u4f4d\u5219\u662f1\u30012\u30014\u30018\u8fd9\u6837\u7684\u5c0f\u503c\uff0c\u7ecf\u5e38\u51fa\u73b0\u53d8\u52a8\u4ee5\u8fbe\u5230\u51d1\u6210\u67d0\u4e2a\u6570\u7684\u6548\u679c\u3002\u8fd9\u6837\u7684\u503c\u548c",Object(b.b)("inlineCode",{parentName:"li"},"1111 1111"),"\u8fd9\u79cd\u51681\u7684\u4e8c\u8fdb\u5236\u505a",Object(b.b)("inlineCode",{parentName:"li"},"\u4e0e"),"\u8fd0\u7b97\uff08\u7528\u5728putVal\u4e2d\u7684\u8ba1\u7b97\u6570\u7ec4\u4e0b\u6807\u7684\u4ee3\u7801\u4e2d\uff09\uff0c\u8fd0\u7b97\u7ed3\u679c\u80fd\u6700\u5927\u7a0b\u5ea6\u53cd\u6620hash\u503c\u7684\u53d8\u5316\uff0c\u964d\u4f4e",Object(b.b)("strong",{parentName:"li"},"\u78b0\u649e\u6982\u7387"),"\u3002"),Object(b.b)("li",{parentName:"ul"},"\u8fd9\u6bb5hash\u65b9\u6cd5\u7684return\u8bed\u53e5\u4e2d\uff0cObject\u65b9\u6cd5\u8fd4\u56de\u7684\u539f\u59cbhash int\u503c\u9ad8\u4f4d\u901a\u5e38\u90fd\u662f1\uff0c\u56e0\u6b64\u53f3\u79fb16\u4f4d\u540e\uff0c\u53d8\u6210\u4e00\u4e2a\u4f4e\u4f4d\u5168\u662f1\u7684\u4e8c\u8fdb\u5236\u6570\uff0c\u540c\u539f\u59cbhash\u505a\u5f02\u6216\u8fd0\u7b97\uff0c\u4e5f\u80fd\u6700\u5927\u7a0b\u5ea6\u4e0a\u53cd\u6620hash\u503c\u7684\u53d8\u5316\uff0c\u964d\u4f4e",Object(b.b)("strong",{parentName:"li"},"\u78b0\u649e\u6982\u7387"))))),Object(b.b)("h3",{id:"hashmap\u80fd\u4e0d\u80fd\u5b58-keynull-valuenull"},"hashmap\u80fd\u4e0d\u80fd\u5b58 key=null, value=null"),Object(b.b)("blockquote",null,Object(b.b)("p",{parentName:"blockquote"},"\u80fd")),Object(b.b)("pre",null,Object(b.b)("code",Object(t.a)({parentName:"pre"},{className:"language-java"}),"static final int hash(Object key) {\n  int h;\n  return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);\n}\n")),Object(b.b)("p",null,"\u5982\u679ckey\u4e3anull\uff0cHashMap\u7684hash\u65b9\u6cd5\u76f4\u63a5\u5c06\u5176hash\u503c\u8bbe\u7f6e\u4e3a0"),Object(b.b)("h2",{id:"\u6269\u5bb9"},"\u6269\u5bb9"),Object(b.b)("p",null,"\u5982\u679c\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e00\u4e2a\u4f4d\u7f6e\u4e0a\u90fd\u5df2\u7ecf\u6709Entry\u4e86\u600e\u4e48\u529e\uff1f\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f"),Object(b.b)("ul",null,Object(b.b)("li",{parentName:"ul"},"\u4f1a\u9891\u7e41\u7684\u6784\u6210\u94fe\u8868"),Object(b.b)("li",{parentName:"ul"},Object(b.b)("strong",{parentName:"li"},"\u56e0\u6b64\u63d0\u51fa\u4e86\u5bf9\u6570\u7ec4\u8fdb\u884c",Object(b.b)("inlineCode",{parentName:"strong"},"\u6269\u5bb9"))),Object(b.b)("li",{parentName:"ul"},"\u5f53\u5df2\u4f7f\u7528\u7684\u6570\u7ec4\u5bb9\u91cf\u8d85\u8fc7 $ \u521d\u59cb\u5bb9\u91cf \\times \u52a0\u8f7d\u56e0\u5b50 $ \uff0c \u9ed8\u8ba4 $16\\times0.75=12$\u65f6\uff0c\u5bf9\u6570\u7ec4\u8fdb\u884c\u6269\u5bb9\uff0c",Object(b.b)("strong",{parentName:"li"},"\u603b\u662f\u6269\u5bb9\u4e3a\u539f\u6765\u76842\u500d\uff0c\u9664\u975e\u8fbe\u5230\u6700\u5927\u6570\u7ec4\u5bb9\u91cf")),Object(b.b)("li",{parentName:"ul"},"\u6269\u5bb9\u7684\u76ee\u7684\uff1a\u51cf\u5c11Hash\u51b2\u7a81\uff0c\u63d0\u9ad8\u67e5\u8be2\u6548\u7387")),Object(b.b)("h3",{id:"resize\u65b9\u6cd5\u6e90\u7801"},"resize()\u65b9\u6cd5\u6e90\u7801"),Object(b.b)("pre",null,Object(b.b)("code",Object(t.a)({parentName:"pre"},{className:"language-java"}),"/**\n * \u6269\u5bb9\u540e\uff0c\u7ea2\u9ed1\u6811\u7684hash\u5206\u5e03\uff0c\u53ea\u53ef\u80fd\u5b58\u5728\u4e8e\u4e24\u4e2a\u4f4d\u7f6e\uff1a\u539f\u7d22\u5f15\u4f4d\u7f6e\u3001\u539f\u7d22\u5f15\u4f4d\u7f6e+oldCap\n */\nfinal void split(HashMap<K,V> map, Node<K,V>[] tab, int index, int bit) {\n    TreeNode<K,V> b = this; // \u62ff\u5230\u8c03\u7528\u6b64\u65b9\u6cd5\u7684\u8282\u70b9\n    TreeNode<K,V> loHead = null, loTail = null; // \u5b58\u50a8\u7d22\u5f15\u4f4d\u7f6e\u4e3a:\u201c\u539f\u7d22\u5f15\u4f4d\u7f6e\u201d\u7684\u8282\u70b9\n    TreeNode<K,V> hiHead = null, hiTail = null; // \u5b58\u50a8\u7d22\u5f15\u4f4d\u7f6e\u4e3a:\u201c\u539f\u7d22\u5f15+oldCap\u201d\u7684\u8282\u70b9\n    int lc = 0, hc = 0;\n    // 1.\u4ee5\u8c03\u7528\u6b64\u65b9\u6cd5\u7684\u8282\u70b9\u5f00\u59cb\uff0c\u904d\u5386\u6574\u4e2a\u7ea2\u9ed1\u6811\u8282\u70b9\n    for (TreeNode<K,V> e = b, next; e != null; e = next) {  // \u4eceb\u8282\u70b9\u5f00\u59cb\u904d\u5386\n        next = (TreeNode<K,V>)e.next;   // next\u8d4b\u503c\u4e3ae\u7684\u4e0b\u4e2a\u8282\u70b9\n        e.next = null;  // \u540c\u65f6\u5c06\u8001\u8868\u7684\u8282\u70b9\u8bbe\u7f6e\u4e3a\u7a7a\uff0c\u4ee5\u4fbf\u5783\u573e\u6536\u96c6\u5668\u56de\u6536\n        // 2.\u5982\u679ce\u7684hash\u503c\u4e0e\u8001\u8868\u7684\u5bb9\u91cf\u8fdb\u884c\u4e0e\u8fd0\u7b97\u4e3a0,\u5219\u6269\u5bb9\u540e\u7684\u7d22\u5f15\u4f4d\u7f6e\u8ddf\u8001\u8868\u7684\u7d22\u5f15\u4f4d\u7f6e\u4e00\u6837\n        if ((e.hash & bit) == 0) {\n            if ((e.prev = loTail) == null)  // \u5982\u679cloTail\u4e3a\u7a7a, \u4ee3\u8868\u8be5\u8282\u70b9\u4e3a\u7b2c\u4e00\u4e2a\u8282\u70b9\n                loHead = e; // \u5219\u5c06loHead\u8d4b\u503c\u4e3a\u7b2c\u4e00\u4e2a\u8282\u70b9\n            else\n                loTail.next = e;    // \u5426\u5219\u5c06\u8282\u70b9\u6dfb\u52a0\u5728loTail\u540e\u9762\n            loTail = e; // \u5e76\u5c06loTail\u8d4b\u503c\u4e3a\u65b0\u589e\u7684\u8282\u70b9\n            ++lc;   // \u7edf\u8ba1\u539f\u7d22\u5f15\u4f4d\u7f6e\u7684\u8282\u70b9\u4e2a\u6570\n        }\n        // 3.\u5982\u679ce\u7684hash\u503c\u4e0e\u8001\u8868\u7684\u5bb9\u91cf\u8fdb\u884c\u4e0e\u8fd0\u7b97\u4e3a1,\u5219\u6269\u5bb9\u540e\u7684\u7d22\u5f15\u4f4d\u7f6e\u4e3a:\u8001\u8868\u7684\u7d22\u5f15\u4f4d\u7f6e\uff0boldCap\n        else {\n            if ((e.prev = hiTail) == null)  // \u5982\u679chiHead\u4e3a\u7a7a, \u4ee3\u8868\u8be5\u8282\u70b9\u4e3a\u7b2c\u4e00\u4e2a\u8282\u70b9\n                hiHead = e; // \u5219\u5c06hiHead\u8d4b\u503c\u4e3a\u7b2c\u4e00\u4e2a\u8282\u70b9\n            else\n                hiTail.next = e;    // \u5426\u5219\u5c06\u8282\u70b9\u6dfb\u52a0\u5728hiTail\u540e\u9762\n            hiTail = e; // \u5e76\u5c06hiTail\u8d4b\u503c\u4e3a\u65b0\u589e\u7684\u8282\u70b9\n            ++hc;   // \u7edf\u8ba1\u7d22\u5f15\u4f4d\u7f6e\u4e3a\u539f\u7d22\u5f15+oldCap\u7684\u8282\u70b9\u4e2a\u6570\n        }\n    }\n    // 4.\u5982\u679c\u539f\u7d22\u5f15\u4f4d\u7f6e\u7684\u8282\u70b9\u4e0d\u4e3a\u7a7a\n    if (loHead != null) {   // \u539f\u7d22\u5f15\u4f4d\u7f6e\u7684\u8282\u70b9\u4e0d\u4e3a\u7a7a\n        // 4.1 \u5982\u679c\u8282\u70b9\u4e2a\u6570<=6\u4e2a\u5219\u5c06\u7ea2\u9ed1\u6811\u8f6c\u4e3a\u94fe\u8868\u7ed3\u6784\n        if (lc <= UNTREEIFY_THRESHOLD)\n            tab[index] = loHead.untreeify(map);\n        else {\n            // 4.2 \u5c06\u539f\u7d22\u5f15\u4f4d\u7f6e\u7684\u8282\u70b9\u8bbe\u7f6e\u4e3a\u5bf9\u5e94\u7684\u5934\u8282\u70b9\n            tab[index] = loHead;\n            // 4.3 \u5982\u679chiHead\u4e0d\u4e3a\u7a7a\uff0c\u5219\u4ee3\u8868\u539f\u6765\u7684\u7ea2\u9ed1\u6811(\u8001\u8868\u7684\u7ea2\u9ed1\u6811\u7531\u4e8e\u8282\u70b9\u88ab\u5206\u5230\u4e24\u4e2a\u4f4d\u7f6e)\n            // \u5df2\u7ecf\u88ab\u6539\u53d8, \u9700\u8981\u91cd\u65b0\u6784\u5efa\u65b0\u7684\u7ea2\u9ed1\u6811\n            if (hiHead != null)\n                // 4.4 \u4ee5loHead\u4e3a\u6839\u8282\u70b9, \u6784\u5efa\u65b0\u7684\u7ea2\u9ed1\u6811\n                loHead.treeify(tab);\n        }\n    }\n    // 5.\u5982\u679c\u7d22\u5f15\u4f4d\u7f6e\u4e3a\u539f\u7d22\u5f15+oldCap\u7684\u8282\u70b9\u4e0d\u4e3a\u7a7a\n    if (hiHead != null) {   // \u7d22\u5f15\u4f4d\u7f6e\u4e3a\u539f\u7d22\u5f15+oldCap\u7684\u8282\u70b9\u4e0d\u4e3a\u7a7a\n        // 5.1 \u5982\u679c\u8282\u70b9\u4e2a\u6570<=6\u4e2a\u5219\u5c06\u7ea2\u9ed1\u6811\u8f6c\u4e3a\u94fe\u8868\u7ed3\u6784\n        if (hc <= UNTREEIFY_THRESHOLD)\n            tab[index + bit] = hiHead.untreeify(map);\n        else {\n            // 5.2 \u5c06\u7d22\u5f15\u4f4d\u7f6e\u4e3a\u539f\u7d22\u5f15+oldCap\u7684\u8282\u70b9\u8bbe\u7f6e\u4e3a\u5bf9\u5e94\u7684\u5934\u8282\u70b9\n            tab[index + bit] = hiHead;\n            // 5.3 loHead\u4e0d\u4e3a\u7a7a\u5219\u4ee3\u8868\u539f\u6765\u7684\u7ea2\u9ed1\u6811(\u8001\u8868\u7684\u7ea2\u9ed1\u6811\u7531\u4e8e\u8282\u70b9\u88ab\u5206\u5230\u4e24\u4e2a\u4f4d\u7f6e)\n            // \u5df2\u7ecf\u88ab\u6539\u53d8, \u9700\u8981\u91cd\u65b0\u6784\u5efa\u65b0\u7684\u7ea2\u9ed1\u6811\n            if (loHead != null)\n                // 5.4 \u4ee5hiHead\u4e3a\u6839\u8282\u70b9, \u6784\u5efa\u65b0\u7684\u7ea2\u9ed1\u6811\n                hiHead.treeify(tab);\n        }\n    }\n}\n")),Object(b.b)("h2",{id:"jdk17\u94fe\u8868\u5934\u63d2\u6cd5\u6539\u4e3ajdk18\u94fe\u8868\u5c3e\u63d2\u6cd5"},"JDK1.7\u94fe\u8868\u5934\u63d2\u6cd5\u6539\u4e3aJDK1.8\u94fe\u8868\u5c3e\u63d2\u6cd5"),Object(b.b)("blockquote",null,Object(b.b)("p",{parentName:"blockquote"},"1.7\u65b0\u5143\u7d20\u5728\u94fe\u8868\u5934\u90e8\u63d2\u5165\uff0c\u5728HashMap\u6269\u5bb9\u65f6\uff0c\u5982\u679c\u662f\u5e76\u53d1\u73af\u5883\uff0c\u53ef\u80fd\u4f1a\u5728\u94fe\u8868\u5143\u7d20\u9006\u5e8f\u65f6\uff0c\u4ea7\u751f\u5faa\u73af\u5f15\u7528\uff0c\u5373\u524d\u4e00\u4e2a\u6307\u5411\u540e\u4e00\u4e2a\uff0c\u540e\u4e00\u4e2a\u53c8\u6307\u5411\u524d\u4e00\u4e2a\uff0c\u5f62\u6210\u73af\u94fe\uff0c\u5bfc\u81f4\u5e76\u53d1\u73af\u5883\u4e0b\u51fa\u73b0\u6b7b\u9501")),Object(b.b)("h2",{id:"jdk18\u5f15\u5165\u7ea2\u9ed1\u6811"},"JDK1.8\u5f15\u5165\u7ea2\u9ed1\u6811"),Object(b.b)("blockquote",null,Object(b.b)("ul",{parentName:"blockquote"},Object(b.b)("li",{parentName:"ul"},"\u56e0\u4e3a\u94fe\u8868\u592a\u957f\u65f6\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4ece\u5e38\u6570\u9636",Object(b.b)("inlineCode",{parentName:"li"},"O(1)"),"\u589e\u957f\u5230\u7ebf\u6027\u9636",Object(b.b)("inlineCode",{parentName:"li"},"O(n)")),Object(b.b)("li",{parentName:"ul"},"\u5f15\u5165\u7ea2\u9ed1\u6811\u590d\u6742\u5ea6\u63a7\u5236\u5728",Object(b.b)("inlineCode",{parentName:"li"},"O(logn)")),Object(b.b)("li",{parentName:"ul"},"\u5f53\u6570\u7ec4\u957f\u5ea6\u5927\u4e8e64\uff0c\u4e14\u94fe\u8868\u957f\u5ea6\u5927\u4e8e8\uff0c\u5c06\u94fe\u8868\u8f6c\u4e3a\u7ea2\u9ed1\u6811"),Object(b.b)("li",{parentName:"ul"},"\u5f53\u94fe\u8868\u957f\u5ea6\u5c0f\u4e8e6\u65f6\uff0c\u8f6c\u56de\u94fe\u8868"),Object(b.b)("li",{parentName:"ul"},"\u6700\u5c0f\u6811\u5bb9\u91cf\u4e3a64"))),Object(b.b)("pre",null,Object(b.b)("code",Object(t.a)({parentName:"pre"},{className:"language-java"}),"/**\n     * The bin count threshold for using a tree rather than list for a\n     * bin.  Bins are converted to trees when adding an element to a\n     * bin with at least this many nodes. The value must be greater\n     * than 2 and should be at least 8 to mesh with assumptions in\n     * tree removal about conversion back to plain bins upon\n     * shrinkage.\n     */\nstatic final int TREEIFY_THRESHOLD = 8;\n\n/**\n     * The bin count threshold for untreeifying a (split) bin during a\n     * resize operation. Should be less than TREEIFY_THRESHOLD, and at\n     * most 6 to mesh with shrinkage detection under removal.\n     */\nstatic final int UNTREEIFY_THRESHOLD = 6;\n")),Object(b.b)("pre",null,Object(b.b)("code",Object(t.a)({parentName:"pre"},{className:"language-java"}),"/**\n     * The smallest table capacity for which bins may be treeified.\n     * (Otherwise the table is resized if too many nodes in a bin.)\n     * Should be at least 4 * TREEIFY_THRESHOLD to avoid conflicts\n     * between resizing and treeification thresholds.\n     */\nstatic final int MIN_TREEIFY_CAPACITY = 64;\n")),Object(b.b)("h2",{id:"hashmap-\u548c-hashtable-\u7684\u533a\u522b"},"HashMap \u548c Hashtable \u7684\u533a\u522b"),Object(b.b)("ul",null,Object(b.b)("li",{parentName:"ul"},Object(b.b)("p",{parentName:"li"},"HashMap \u5141\u8bb8 key \u548c value \u4e3a null\uff0cHashtable \u4e0d\u5141\u8bb8\u3002")),Object(b.b)("li",{parentName:"ul"},Object(b.b)("p",{parentName:"li"},"HashMap \u7684\u9ed8\u8ba4\u521d\u59cb\u5bb9\u91cf\u4e3a 16\uff0cHashtable \u4e3a 11\u3002")),Object(b.b)("li",{parentName:"ul"},Object(b.b)("p",{parentName:"li"},"HashMap \u7684\u6269\u5bb9\u4e3a\u539f\u6765\u7684 2 \u500d\uff0cHashtable \u7684\u6269\u5bb9\u4e3a\u539f\u6765\u7684 2 \u500d\u52a0 1\u3002")),Object(b.b)("li",{parentName:"ul"},Object(b.b)("p",{parentName:"li"},"HashMap \u662f\u975e\u7ebf\u7a0b\u5b89\u5168\u7684\uff0cHashtable\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002")),Object(b.b)("li",{parentName:"ul"},Object(b.b)("p",{parentName:"li"},"HashMap \u7684 hash \u503c\u91cd\u65b0\u8ba1\u7b97\u8fc7\uff0cHashtable \u76f4\u63a5\u4f7f\u7528 hashCode\u3002")),Object(b.b)("li",{parentName:"ul"},Object(b.b)("p",{parentName:"li"},"HashMap \u53bb\u6389\u4e86 Hashtable \u4e2d\u7684 contains \u65b9\u6cd5\u3002")),Object(b.b)("li",{parentName:"ul"},Object(b.b)("p",{parentName:"li"},"HashMap \u7ee7\u627f\u81ea AbstractMap \u7c7b\uff0cHashtable \u7ee7\u627f\u81ea Dictionary \u7c7b\u3002"))),Object(b.b)("h1",{id:"concurrenthashmap"},"ConcurrentHashMap"),Object(b.b)("blockquote",null,Object(b.b)("p",{parentName:"blockquote"},Object(b.b)("strong",{parentName:"p"},"\u5206\u6bb5\u9501\u5b9e\u73b0\u7ebf\u7a0b\u5b89\u5168"),"\u2014\u2014",Object(b.b)("a",Object(t.a)({parentName:"p"},{href:"https://www.jianshu.com/p/d10256f0ebea"}),"ConcurrentHashMap\u539f\u7406\u89e3\u6790")),Object(b.b)("ul",{parentName:"blockquote"},Object(b.b)("li",{parentName:"ul"},Object(b.b)("strong",{parentName:"li"},"ConcurrentHashMap\u4e0d\u5141\u8bb8",Object(b.b)("inlineCode",{parentName:"strong"},"null"),"\u4f5c\u4e3akey\u6216\u8005value\uff0c\u4f1a\u629b\u51fa\u7a7a\u6307\u9488\u5f02\u5e38")))),Object(b.b)("p",null,Object(b.b)("strong",{parentName:"p"},"HashTable\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u4f7f\u7528HashTable\uff1f")),Object(b.b)("blockquote",null,Object(b.b)("ul",{parentName:"blockquote"},Object(b.b)("li",{parentName:"ul"},"HashTable\u57fa\u4e8esynchronized\u8fdb\u884c\u65b9\u6cd5\u540c\u6b65\uff0c\u8bfb\u3001\u5199\u90fd\u662f\u7528\u4e86synchronized\uff0c\u63d2\u5165\u65f6\u4e0d\u80fd\u8bfb\uff0c\u8bfb\u53d6\u65f6\u4e0d\u80fd\u5199\uff0c",Object(b.b)("strong",{parentName:"li"},"\u56e0\u4e3aHashTable"),"\u9501\u7684\u662f\u6574\u4e2a\u96c6\u5408\uff0c\u5168\u8868\u9501\uff0c\u591a\u7ebf\u7a0b\u60c5\u51b5\u4e0b\u6548\u7387\u6781\u4f4e"),Object(b.b)("li",{parentName:"ul"},"\u4e8e\u662f\uff0cConcurrentHashMap\u4f7f\u7528\u4e86\u5206\u6bb5\u9501\u6280\u672f\uff0c\u91c7\u7528\u7ec6\u7c92\u5ea6\u9501\uff0c\u53ea\u9501\u96c6\u5408\u7684\u4e00\u90e8\u5206"))),Object(b.b)("h2",{id:"jdk15--segment\u7ea7\u53ef\u91cd\u5165\u9501"},"JDK1.5 \u2014\u2014 Segment\u7ea7\u53ef\u91cd\u5165\u9501"),Object(b.b)("blockquote",null,Object(b.b)("ul",{parentName:"blockquote"},Object(b.b)("li",{parentName:"ul"},"\u7531\u4e00\u4e2a",Object(b.b)("inlineCode",{parentName:"li"},"segments"),"\u6570\u7ec4\u6784\u6210\uff0c\u91cc\u9762\u5b58\u653e\u7740",Object(b.b)("inlineCode",{parentName:"li"},"segment"),"\uff0c\u6bcf\u4e2a",Object(b.b)("inlineCode",{parentName:"li"},"segment"),"\u91cc\u9762\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u4e0a\u7684\u6bcf\u4e2a\u5143\u7d20\u662fEntry\u5bf9\u8c61\u6784\u6210\u7684\u94fe\u8868"),Object(b.b)("li",{parentName:"ul"},"\u6bcf\u4e2a",Object(b.b)("inlineCode",{parentName:"li"},"segment"),"\u5177\u6709\u4e00\u628a\u9501\uff0c\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u5360\u7528\u4e00\u4e2a",Object(b.b)("inlineCode",{parentName:"li"},"segment"),"\uff0c\u53ea\u4f1a\u9501\u5f53\u524d\u7684",Object(b.b)("inlineCode",{parentName:"li"},"segment"),"\uff0c\u5176\u4ed6\u7684",Object(b.b)("inlineCode",{parentName:"li"},"segment"),"\u4f9d\u7136\u53ef\u4ee5\u88ab\u8bbf\u95ee"),Object(b.b)("li",{parentName:"ul"},"\u9ed8\u8ba416\u4e2a",Object(b.b)("inlineCode",{parentName:"li"},"segment")))),Object(b.b)("p",null,Object(b.b)("img",{alt:"image-20200626192419278",src:n(634).default})),Object(b.b)("h2",{id:"jdk18\u94fe\u8868\u5934cassynchronized\u7ec6\u7c92\u5ea6\u9501"},"JDK1.8\u2014\u2014\u94fe\u8868\u5934CAS+synchronized\u7ec6\u7c92\u5ea6\u9501"),Object(b.b)("blockquote",null,Object(b.b)("ul",{parentName:"blockquote"},Object(b.b)("li",{parentName:"ul"},"\u53d6\u6d88\u4e86",Object(b.b)("inlineCode",{parentName:"li"},"Segments"),"\uff0c\u7ed3\u6784\u4e0eJDK1.8 HashMap\u76f8\u540c"),Object(b.b)("li",{parentName:"ul"},"\u91c7\u7528CAS+synchronized\uff0c\u9501\u94fe\u8868\u5934\u7ed3\u70b9\u6216\u7ea2\u9ed1\u6811\u6839\u7ed3\u70b9"),Object(b.b)("li",{parentName:"ul"},"\u53ea\u8981hash\u4e0d\u51b2\u7a81\uff0c\u5c31\u4e0d\u4f1a\u4ea7\u751f\u5e76\u53d1"),Object(b.b)("li",{parentName:"ul"},"\u76f8\u6bd41.5\u7684\u5b9e\u73b0\uff0c\u9501\u7c92\u5ea6\u66f4\u7ec6\uff0c\u6548\u7387\u66f4\u9ad8"))),Object(b.b)("p",null,Object(b.b)("img",{alt:"image-20200626192834864",src:n(635).default})),Object(b.b)("ul",null,Object(b.b)("li",{parentName:"ul"},Object(b.b)("strong",{parentName:"li"},"put\u65b9\u6cd5"))),Object(b.b)("blockquote",null,Object(b.b)("p",{parentName:"blockquote"},Object(b.b)("strong",{parentName:"p"},"\u5206\u6790\u5982\u4f55\u5229\u7528CAS\u548csynchronized\u8fdb\u884c\u9ad8\u6548\u540c\u6b65\u6570\u636e\u66f4\u65b0"))),Object(b.b)("pre",null,Object(b.b)("code",Object(t.a)({parentName:"pre"},{className:"language-java"}),"public V put(K key, V value) {\n    return putVal(key, value, false);\n}\n\n    /** Implementation for put and putIfAbsent */\nfinal V putVal(K key, V value, boolean onlyIfAbsent) {\n    //ConcurrentHashMap \u4e0d\u5141\u8bb8\u63d2\u5165null\u952e\uff0cHashMap\u5141\u8bb8\u63d2\u5165\u4e00\u4e2anull\u952e\n    if (key == null || value == null) throw new NullPointerException();\n    //\u8ba1\u7b97key\u7684hash\u503c\n    int hash = spread(key.hashCode());\n    int binCount = 0;\n    //for\u5faa\u73af\u7684\u4f5c\u7528\uff1a\u56e0\u4e3a\u66f4\u65b0\u5143\u7d20\u662f\u4f7f\u7528CAS\u673a\u5236\u66f4\u65b0\uff0c\u9700\u8981\u4e0d\u65ad\u7684\u5931\u8d25\u91cd\u8bd5\uff0c\u76f4\u5230\u6210\u529f\u4e3a\u6b62\u3002\n    for (Node<K,V>[] tab = table;;) {\n        // f\uff1a\u94fe\u8868\u6216\u7ea2\u9ed1\u4e8c\u53c9\u6811\u5934\u7ed3\u70b9\uff0c\u5411\u94fe\u8868\u4e2d\u6dfb\u52a0\u5143\u7d20\u65f6\uff0c\u9700\u8981synchronized\u83b7\u53d6f\u7684\u9501\u3002\n        Node<K,V> f; int n, i, fh;\n        //\u5224\u65adNode[]\u6570\u7ec4\u662f\u5426\u521d\u59cb\u5316\uff0c\u6ca1\u6709\u5219\u8fdb\u884c\u521d\u59cb\u5316\u64cd\u4f5c\n        if (tab == null || (n = tab.length) == 0)\n            tab = initTable();\n        //\u901a\u8fc7hash\u5b9a\u4f4dNode[]\u6570\u7ec4\u7684\u7d22\u5f15\u5750\u6807\uff0c\u662f\u5426\u6709Node\u8282\u70b9\uff0c\u5982\u679c\u6ca1\u6709\u5219\u4f7f\u7528CAS\u8fdb\u884c\u6dfb\u52a0\uff08\u94fe\u8868\u7684\u5934\u7ed3\u70b9\uff09\uff0c\u6dfb\u52a0\u5931\u8d25\u5219\u8fdb\u5165\u4e0b\u6b21\u5faa\u73af\u3002\n        else if ((f = tabAt(tab, i = (n - 1) & hash)) == null) {\n            if (casTabAt(tab, i, null,\n                         new Node<K,V>(hash, key, value, null)))\n                break;                   // no lock when adding to empty bin\n        }\n        //\u68c0\u67e5\u5230\u5185\u90e8\u6b63\u5728\u79fb\u52a8\u5143\u7d20\uff08Node[] \u6570\u7ec4\u6269\u5bb9\uff09\n        else if ((fh = f.hash) == MOVED)\n            //\u5e2e\u52a9\u5b83\u6269\u5bb9\n            tab = helpTransfer(tab, f);\n        else {\n            V oldVal = null;\n            //\u9501\u4f4f\u94fe\u8868\u6216\u7ea2\u9ed1\u4e8c\u53c9\u6811\u7684\u5934\u7ed3\u70b9\n            synchronized (f) {\n                //\u5224\u65adf\u662f\u5426\u662f\u94fe\u8868\u7684\u5934\u7ed3\u70b9\n                if (tabAt(tab, i) == f) {\n                    //\u5982\u679cfh>=0 \u662f\u94fe\u8868\u8282\u70b9\n                    if (fh >= 0) {\n                        binCount = 1;\n                        //\u904d\u5386\u94fe\u8868\u6240\u6709\u8282\u70b9\n                        for (Node<K,V> e = f;; ++binCount) {\n                            K ek;\n                            //\u5982\u679c\u8282\u70b9\u5b58\u5728\uff0c\u5219\u66f4\u65b0value\n                            if (e.hash == hash &&\n                                ((ek = e.key) == key ||\n                                 (ek != null && key.equals(ek)))) {\n                                oldVal = e.val;\n                                if (!onlyIfAbsent)\n                                    e.val = value;\n                                break;\n                            }\n                            //\u4e0d\u5b58\u5728\u5219\u5728\u94fe\u8868\u5c3e\u90e8\u6dfb\u52a0\u65b0\u8282\u70b9\u3002\n                            Node<K,V> pred = e;\n                            if ((e = e.next) == null) {\n                                pred.next = new Node<K,V>(hash, key,\n                                                          value, null);\n                                break;\n                            }\n                        }\n                    }\n                    //TreeBin\u662f\u7ea2\u9ed1\u4e8c\u53c9\u6811\u8282\u70b9\n                    else if (f instanceof TreeBin) {\n                        Node<K,V> p;\n                        binCount = 2;\n                        //\u6dfb\u52a0\u6811\u8282\u70b9\n                        if ((p = ((TreeBin<K,V>)f).putTreeVal(hash, key,\n                                                      value)) != null) {\n                            oldVal = p.val;\n                            if (!onlyIfAbsent)\n                                p.val = value;\n                        }\n                    }\n                }\n            }\n            \n            if (binCount != 0) {\n                //\u5982\u679c\u94fe\u8868\u957f\u5ea6\u5df2\u7ecf\u8fbe\u5230\u4e34\u754c\u503c8 \u5c31\u9700\u8981\u628a\u94fe\u8868\u8f6c\u6362\u4e3a\u6811\u7ed3\u6784\n                if (binCount >= TREEIFY_THRESHOLD)\n                    treeifyBin(tab, i);\n                if (oldVal != null)\n                    return oldVal;\n                break;\n            }\n        }\n    }\n    //\u5c06\u5f53\u524dConcurrentHashMap\u7684size\u6570\u91cf+1\n    addCount(1L, binCount);\n    return null;\n}\n")),Object(b.b)("ol",null,Object(b.b)("li",{parentName:"ol"},"\u5224\u65adNode[]\u6570\u7ec4\u662f\u5426\u521d\u59cb\u5316\uff0c\u6ca1\u6709\u5219\u8fdb\u884c\u521d\u59cb\u5316\u64cd\u4f5c"),Object(b.b)("li",{parentName:"ol"},"\u901a\u8fc7hash\u5b9a\u4f4dNode[]\u6570\u7ec4\u7684\u7d22\u5f15\u5750\u6807\uff0c\u662f\u5426\u6709Node\u8282\u70b9\uff0c\u5982\u679c\u6ca1\u6709\u5219\u4f7f\u7528CAS\u8fdb\u884c\u6dfb\u52a0\uff08\u94fe\u8868\u7684\u5934\u7ed3\u70b9\uff09\uff0c\u6dfb\u52a0\u5931\u8d25\u5219\u8fdb\u5165\u4e0b\u6b21\u5faa\u73af\u3002"),Object(b.b)("li",{parentName:"ol"},"\u68c0\u67e5\u5230\u5185\u90e8\u6b63\u5728\u6269\u5bb9\uff0c\u5982\u679c\u6b63\u5728\u6269\u5bb9\uff0c\u5c31\u5e2e\u52a9\u5b83\u4e00\u5757\u6269\u5bb9\u3002"),Object(b.b)("li",{parentName:"ol"},"\u5982\u679cf!=null\uff0c\u5219\u4f7f\u7528synchronized\u9501\u4f4ff\u5143\u7d20\uff08\u94fe\u8868/\u7ea2\u9ed1\u4e8c\u53c9\u6811\u7684\u5934\u5143\u7d20\uff09\n4.1 \u5982\u679c\u662fNode(\u94fe\u8868\u7ed3\u6784)\u5219\u6267\u884c\u94fe\u8868\u7684\u6dfb\u52a0\u64cd\u4f5c\u3002\n4.2 \u5982\u679c\u662fTreeNode(\u6811\u578b\u7ed3\u679c)\u5219\u6267\u884c\u6811\u6dfb\u52a0\u64cd\u4f5c\u3002"),Object(b.b)("li",{parentName:"ol"},"\u5224\u65ad\u94fe\u8868\u957f\u5ea6\u5df2\u7ecf\u8fbe\u5230\u4e34\u754c\u503c8 \u5c31\u9700\u8981\u628a\u94fe\u8868\u8f6c\u6362\u4e3a\u6811\u7ed3\u6784\u3002")),Object(b.b)("blockquote",null,Object(b.b)("p",{parentName:"blockquote"}," ",Object(b.b)("strong",{parentName:"p"},"\u603b\u7ed3\uff1a"))),Object(b.b)("ul",null,Object(b.b)("li",{parentName:"ul"},Object(b.b)("p",{parentName:"li"},"JDK8\u4e2d\u7684\u5b9e\u73b0\u4e5f\u662f\u9501\u5206\u79bb\u7684\u601d\u60f3\uff0c\u5b83\u628a\u9501\u5206\u7684\u6bd4segment\uff08JDK1.5\uff09\u66f4\u7ec6\u4e00\u4e9b\uff0c\u53ea\u8981hash\u4e0d\u51b2\u7a81\uff0c\u5c31\u4e0d\u4f1a\u51fa\u73b0\u5e76\u53d1\u83b7\u5f97\u9501\u7684\u60c5\u51b5\u3002")),Object(b.b)("li",{parentName:"ul"},Object(b.b)("p",{parentName:"li"},"\u5b83\u9996\u5148\u4f7f\u7528\u65e0\u9501\u64cd\u4f5cCAS\u63d2\u5165\u5934\u7ed3\u70b9\uff0c\u5982\u679c\u63d2\u5165\u5931\u8d25\uff0c\u8bf4\u660e\u5df2\u7ecf\u6709\u522b\u7684\u7ebf\u7a0b\u63d2\u5165\u5934\u7ed3\u70b9\u4e86\uff0c\u518d\u6b21\u5faa\u73af\u8fdb\u884c\u64cd\u4f5c\u3002")),Object(b.b)("li",{parentName:"ul"},Object(b.b)("p",{parentName:"li"},"\u5982\u679c\u5934\u7ed3\u70b9\u5df2\u7ecf\u5b58\u5728\uff0c\u5219\u901a\u8fc7synchronized\u83b7\u5f97\u5934\u7ed3\u70b9\u9501\uff0c\u8fdb\u884c\u540e\u7eed\u7684\u64cd\u4f5c\u3002\u6027\u80fd\u6bd4segment\u5206\u6bb5\u9501\u53c8\u518d\u6b21\u63d0\u5347"))),Object(b.b)("h1",{id:"\u9762\u8bd5\u9898"},"\u9762\u8bd5\u9898"),Object(b.b)("ul",null,Object(b.b)("li",{parentName:"ul"},"HashMap\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898\u53d1\u751f\u5728\u54ea\u4e2a\u9636\u6bb5\uff1f\u8bbe\u8ba1\u4e00\u4e2a\u65b9\u6848\u9a8c\u8bc1HashMap\u7684\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898",Object(b.b)("ul",{parentName:"li"},Object(b.b)("li",{parentName:"ul"},"\u51c6\u5907\u591a\u4e2a\u7ebf\u7a0b"),Object(b.b)("li",{parentName:"ul"},"\u540c\u65f6\u8bbf\u95ee\u540c\u4e00\u4e2aHashMap")))),Object(b.b)("pre",null,Object(b.b)("code",Object(t.a)({parentName:"pre"},{className:"language-java"}),"public static void main(String[] args) throws InterruptedException {\n    Map<Object, Object> map = new HashMap<>();\n  \n    new Thread(() -> {\n      for (int i = 0; i < 2500; i++) {\n        map.put(i, i);\n      }\n    }).start();\n  \n    new Thread(() -> {\n      for (int i = 2500; i < 5000; i++) {\n        map.put(i, i);\n      }\n    }).start();\n  \n    //\u4e3a\u4e86\u7ed3\u679c\u5b8c\u6574\uff0c\u6700\u597d\u4e3b\u7ebf\u7a0b\u7761\u4e00\u4f1a\u513f\u518d\u6253\u5370\n    Thread.currentThread().sleep(1000);\n    System.out.println(map.size());\n}\n")),Object(b.b)("pre",null,Object(b.b)("code",Object(t.a)({parentName:"pre"},{}),"4862\n")),Object(b.b)("ul",null,Object(b.b)("li",{parentName:"ul"},"HashMap\u80fd\u4e0d\u80fd\u5b58null,null"),Object(b.b)("li",{parentName:"ul"},"HashMap\u6269\u5bb9\u5927\u5c0f\u4e3a\u4ec0\u4e48\u603b\u662f2\u7684\u6b21\u5e42"),Object(b.b)("li",{parentName:"ul"},"HashMap\u5e95\u5c42\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u5f02\u6216\u8fd0\u7b97"),Object(b.b)("li",{parentName:"ul"},"HashMap\u5982\u4f55\u786e\u5b9a\u952e\u503c\u5bf9\u4f4d\u7f6e\uff0c\u5982\u4f55\u89e3\u51b3Hash\u51b2\u7a81"),Object(b.b)("li",{parentName:"ul"},"HashMap\u52a0\u8f7d\u56e0\u5b50\u4e3a\u4ec0\u4e48\u4e3a0.75\uff0c\u5982\u679c\u6539\u4e3a1\u5462"),Object(b.b)("li",{parentName:"ul"},"HashMap\u4e0eConcurrentHashMap\u7684\u533a\u522b"),Object(b.b)("li",{parentName:"ul"},"ConcurrentHashMap\u662f\u5982\u4f55\u5b9e\u73b0\u7ebf\u7a0b\u5b89\u5168\u7684",Object(b.b)("ul",{parentName:"li"},Object(b.b)("li",{parentName:"ul"},"\u5206\u6bb5\u9501"))),Object(b.b)("li",{parentName:"ul"},"HashMap\u4f1a\u7f29\u5bb9\u5417",Object(b.b)("ul",{parentName:"li"},Object(b.b)("li",{parentName:"ul"},"\u4e0d\u4f1a\uff0c\u53cd\u590d\u6a2a\u8df3\u53cd\u800c\u662f\u4e00\u79cd\u6d6a\u8d39\u8d44\u6e90\u7684\u64cd\u4f5c"),Object(b.b)("li",{parentName:"ul"},"\u66fe\u7ecf\u6269\u5bb9\u4e0a\u53bb\u4e86\uff0c\u5c31\u8bf4\u660e\u8fd9\u4e2a\u573a\u666f\u786e\u5b9e\u4f1a\u7528\u5230\u5f88\u5927\u7684\u5bb9\u91cf"),Object(b.b)("li",{parentName:"ul"},"\u53ef\u4ee5\u624b\u52a8\u7f29(\u7565)"))),Object(b.b)("li",{parentName:"ul"},"\u6269\u5bb9\u540e\uff0c\u8282\u70b9\u91cd hash \u4e3a\u4ec0\u4e48\u53ea\u53ef\u80fd\u5206\u5e03\u5728 \u201c\u539f\u7d22\u5f15\u4f4d\u7f6e\u201d \u4e0e \u201c\u539f\u7d22\u5f15 + oldCap \u4f4d\u7f6e\u201d?",Object(b.b)("ul",{parentName:"li"},Object(b.b)("li",{parentName:"ul"},Object(b.b)("a",Object(t.a)({parentName:"li"},{href:"https://blog.csdn.net/v123411739/article/details/78996181"}),"\u53f2\u4e0a\u6700\u8be6\u7ec6JDK1.8 HashMap\u6e90\u7801\u5206\u6790"))))))}o.isMDXComponent=!0},336:function(e,a,n){"use strict";n.d(a,"a",(function(){return s})),n.d(a,"b",(function(){return j}));var t=n(0),l=n.n(t);function b(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function i(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,t)}return n}function r(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?i(Object(n),!0).forEach((function(a){b(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function c(e,a){if(null==e)return{};var n,t,l=function(e,a){if(null==e)return{};var n,t,l={},b=Object.keys(e);for(t=0;t<b.length;t++)n=b[t],a.indexOf(n)>=0||(l[n]=e[n]);return l}(e,a);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(e);for(t=0;t<b.length;t++)n=b[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var p=l.a.createContext({}),o=function(e){var a=l.a.useContext(p),n=a;return e&&(n="function"==typeof e?e(a):r(r({},a),e)),n},s=function(e){var a=o(e.components);return l.a.createElement(p.Provider,{value:a},e.children)},u={inlineCode:"code",wrapper:function(e){var a=e.children;return l.a.createElement(l.a.Fragment,{},a)}},h=l.a.forwardRef((function(e,a){var n=e.components,t=e.mdxType,b=e.originalType,i=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),s=o(n),h=t,j=s["".concat(i,".").concat(h)]||s[h]||u[h]||b;return n?l.a.createElement(j,r(r({ref:a},p),{},{components:n})):l.a.createElement(j,r({ref:a},p))}));function j(e,a){var n=arguments,t=a&&a.mdxType;if("string"==typeof e||t){var b=n.length,i=new Array(b);i[0]=h;var r={};for(var c in a)hasOwnProperty.call(a,c)&&(r[c]=a[c]);r.originalType=e,r.mdxType="string"==typeof e?e:t,i[1]=r;for(var p=2;p<b;p++)i[p]=n[p];return l.a.createElement.apply(null,i)}return l.a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},633:function(e,a,n){"use strict";n.r(a),a.default=n.p+"assets/images/3-c7fca0efa08d784fe8b8972774a613e5.png"},634:function(e,a,n){"use strict";n.r(a),a.default=n.p+"assets/images/4-9a58df7b1b1a05a35ad484251bbb8413.png"},635:function(e,a,n){"use strict";n.r(a),a.default=n.p+"assets/images/5-9487da654102d8ba5ddc08b0839a2e28.png"}}]);