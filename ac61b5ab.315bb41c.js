(window.webpackJsonp=window.webpackJsonp||[]).push([[348],{404:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return p})),n.d(t,"default",(function(){return o}));var r=n(2),a=n(6),l=(n(0),n(561)),i={id:"12.interceptor",title:"\u62e6\u622a\u5668",hide_title:!0},c={unversionedId:"springmvc/12.interceptor",id:"springmvc/12.interceptor",isDocsHomePage:!1,title:"\u62e6\u622a\u5668",description:"\u62e6\u622a\u5668",source:"@site/docs/springmvc/12.\u62e6\u622a\u5668.md",slug:"/springmvc/12.interceptor",permalink:"/docs/springmvc/12.interceptor",version:"current",sidebar:"someSidebar",previous:{title:"Ajax\u9a8c\u8bc1\u7528\u6237\u540d",permalink:"/docs/springmvc/11.ajaxValidate"},next:{title:"\u6587\u4ef6\u4e0a\u4f20\u4e0e\u4e0b\u8f7d",permalink:"/docs/springmvc/13.updownLoad"}},p=[{value:"\u62e6\u622a\u5668",id:"\u62e6\u622a\u5668",children:[{value:"\u6982\u8ff0",id:"\u6982\u8ff0",children:[{value:"\u8fc7\u6ee4\u5668",id:"\u8fc7\u6ee4\u5668",children:[]},{value:"\u62e6\u622a\u5668",id:"\u62e6\u622a\u5668-1",children:[]}]},{value:"\u81ea\u5b9a\u4e49\u62e6\u622a\u5668",id:"\u81ea\u5b9a\u4e49\u62e6\u622a\u5668",children:[{value:"\u653e\u884c",id:"\u653e\u884c",children:[]},{value:"\u62e6\u622a",id:"\u62e6\u622a",children:[]}]},{value:"\u62e6\u622a\u5668\u5b9e\u73b0\u767b\u5f55\u5224\u65ad\u9a8c\u8bc1",id:"\u62e6\u622a\u5668\u5b9e\u73b0\u767b\u5f55\u5224\u65ad\u9a8c\u8bc1",children:[{value:"\u767b\u5f55\u62e6\u622a\u5668",id:"\u767b\u5f55\u62e6\u622a\u5668",children:[]}]}]}],b={rightToc:p};function o(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(l.b)("wrapper",Object(r.a)({},b,n,{components:t,mdxType:"MDXLayout"}),Object(l.b)("h1",{id:"\u62e6\u622a\u5668"},"\u62e6\u622a\u5668"),Object(l.b)("h2",{id:"\u6982\u8ff0"},"\u6982\u8ff0"),Object(l.b)("p",null,"SpringMVC\u7684\u5904\u7406\u5668\u62e6\u622a\u5668\u7c7b\u4f3c\u4e8eServlet\u5f00\u53d1\u4e2d\u7684\u8fc7\u6ee4\u5668Filter\uff0c\u7528\u4e8e\u5bf9\u5904\u7406\u5668\u8fdb\u884c\u9884\u5904\u7406\u548c\u540e\u5904\u7406\u3002\u5f00\u53d1\u8005\u53ef\u4ee5\u81ea\u5df1\u5b9a\u4e49\u4e00\u4e9b\u62e6\u622a\u5668\u6765\u5b9e\u73b0\u7279\u5b9a\u7684\u529f\u80fd"),Object(l.b)("p",null,Object(l.b)("strong",{parentName:"p"},"\u8fc7\u6ee4\u5668\u4e0e\u62e6\u622a\u5668\u7684\u533a\u522b\uff1a"),"\u62e6\u622a\u5668\u662fAOP\u601d\u60f3\u7684\u5177\u4f53\u5e94\u7528"),Object(l.b)("h3",{id:"\u8fc7\u6ee4\u5668"},"\u8fc7\u6ee4\u5668"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"Servlet\u89c4\u8303\u4e2d\u7684\u4e00\u90e8\u5206\uff0c\u4efb\u4f55Java Web\u5de5\u7a0b\u90fd\u53ef\u4ee5\u4f7f\u7528"),Object(l.b)("li",{parentName:"ul"},"\u5728url-pattern\u4e2d\u914d\u7f6e\u4e86",Object(l.b)("inlineCode",{parentName:"li"},"/*"),"\u4e4b\u540e\uff0c\u53ef\u4ee5\u5bf9\u6240\u6709\u8981\u8bbf\u95ee\u7684\u8d44\u6e90\u8fdb\u884c\u62e6\u622a")),Object(l.b)("h3",{id:"\u62e6\u622a\u5668-1"},"\u62e6\u622a\u5668"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"\u62e6\u622a\u5668\u662fSpringMVC\u6846\u67b6\u81ea\u5df1\u7684\uff0c\u53ea\u6709\u4f7f\u7528\u4e86SpringMVC\u6846\u67b6\u7684\u5de5\u7a0b\u624d\u80fd\u4f7f\u7528"),Object(l.b)("li",{parentName:"ul"},"\u62e6\u622a\u5668\u6307\u6325\u62e6\u622a\u8bbf\u95ee\u7684\u63a7\u5236\u5668\u65b9\u6cd5\uff0c\u5982\u679c\u8bbf\u95ee\u7684\u662f\u9759\u6001\u8d44\u6e90\u5219\u4e0d\u4f1a\u8fdb\u884c\u62e6\u622a\uff0c",Object(l.b)("strong",{parentName:"li"},"\u81ea\u5e26\u9759\u6001\u8d44\u6e90\u8fc7\u6ee4"))),Object(l.b)("h2",{id:"\u81ea\u5b9a\u4e49\u62e6\u622a\u5668"},"\u81ea\u5b9a\u4e49\u62e6\u622a\u5668"),Object(l.b)("p",null,Object(l.b)("strong",{parentName:"p"},"\u60f3\u8981\u81ea\u5b9a\u4e49\u62e6\u622a\u5668\uff0c\u5fc5\u987b\u5b9e\u73b0",Object(l.b)("inlineCode",{parentName:"strong"},"HandlerInterceptor"),"\u63a5\u53e3")),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"\u65b0\u5efaMaven\u6a21\u5757,springmvc-08-interceptor\uff0c\u6dfb\u52a0web\u652f\u6301\uff0c\u66f4\u6539artifact\uff0c\u589e\u52a0lib\u6587\u4ef6\u5939"),Object(l.b)("li",{parentName:"ul"},"\u914d\u7f6eweb.xml\u548cspringmvc_servlet.xml"),Object(l.b)("li",{parentName:"ul"},"\u90e8\u7f72tomcat"),Object(l.b)("li",{parentName:"ul"},"\u7f16\u5199\u4e00\u4e2a\u62e6\u622a\u5668\uff0c\u91cd\u5199\u65b9\u6cd5",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"boolean preHandle",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"true:\uff1a\u653e\u884c\uff0c\u6267\u884c\u4e0b\u4e00\u4e2a\u62e6\u622a\u5668"),Object(l.b)("li",{parentName:"ul"},"false\uff1a\u62e6\u622a"))),Object(l.b)("li",{parentName:"ul"},"postHandle"),Object(l.b)("li",{parentName:"ul"},"afterCompletion")))),Object(l.b)("h3",{id:"\u653e\u884c"},"\u653e\u884c"),Object(l.b)("pre",null,Object(l.b)("code",Object(r.a)({parentName:"pre"},{className:"language-java"}),'public class MyInterceptor implements HandlerInterceptor {\n\n    /***\n     *\n     * @return true \u653e\u884c ;  false\u62e6\u622a\uff0c\u4e0d\u6267\u884c\u4e0b\u4e00\u4e2a\u62e6\u622a\u5668\n     */\n    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\n        System.out.println("---------\u5904\u7406\u524d------------");\n        return true;\n    }\n\n    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {\n        System.out.println("------------\u5904\u7406\u540e---------");\n    }\n\n    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {\n        System.out.println("---------\u6e05\u7406-----------");\n    }\n}\n')),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"\u5728springmvc_servlet.xml\u4e2d\u914d\u7f6e\u62e6\u622a\u5668"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",Object(r.a)({parentName:"pre"},{className:"language-xml"}),'\x3c!--    \u62e6\u622a\u5668\u914d\u7f6e--\x3e\n<mvc:interceptors>\n    <mvc:interceptor>\n        \x3c!-- \u62e6\u622a\u6240\u6709\u8fd9\u4e2a\u8bf7\u6c42\u4e0b\u9762\u7684\u6240\u6709\u8bf7\u6c42--\x3e\n        <mvc:mapping path="/**"/>\n        <bean class="com.bsx.controller.MyInterceptor"/>\n    </mvc:interceptor>\n</mvc:interceptors>\n'))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"\u914d\u7f6e\u4e00\u4e2aController\uff0c\u5904\u7406\u8def\u7531",Object(l.b)("inlineCode",{parentName:"p"},"/t1")),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",Object(r.a)({parentName:"pre"},{className:"language-java"}),'@RestController\npublic class TestController {\n\n    @GetMapping("/t1")\n    public String test1() {\n        System.out.println("\u6267\u884c\u4e86TestController /t1\u8def\u7531");\n        return "OK";\n    }\n}\n'))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"\u6d4b\u8bd5\uff0c\u63a7\u5236\u53f0\u8f93\u51fa"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",Object(r.a)({parentName:"pre"},{}),"---------\u5904\u7406\u524d------------\n\u6267\u884c\u4e86TestController /t1\u8def\u7531\n------------\u5904\u7406\u540e---------\n---------\u6e05\u7406-----------\n")))),Object(l.b)("h3",{id:"\u62e6\u622a"},"\u62e6\u622a"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"\u5c06boolean preHandle\u7684\u8fd4\u56de\u503c\u8bbe\u5b9a\u4e3a",Object(l.b)("inlineCode",{parentName:"p"},"false"),"\u5373\u53ef"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",Object(r.a)({parentName:"pre"},{className:"language-java"}),'/***\n     *\n     * @return true \u653e\u884c ;  false\u62e6\u622a\uff0c\u4e0d\u6267\u884c\u4e0b\u4e00\u4e2a\u62e6\u622a\u5668\n     */\npublic boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\n    System.out.println("---------\u5904\u7406\u524d------------");\n    return false;\n}\n'))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"\u6d4b\u8bd5\uff0c\u8bbf\u95ee",Object(l.b)("inlineCode",{parentName:"p"},"/t1"),"\u8def\u7531\uff0c\u53d1\u73b0Controller\u4e0d\u4f1a\u88ab\u6267\u884c\uff0c\u62e6\u622a\u6210\u529f"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",Object(r.a)({parentName:"pre"},{}),"---------\u5904\u7406\u524d------------\n---------\u5904\u7406\u524d------------\n---------\u5904\u7406\u524d------------\n---------\u5904\u7406\u524d------------\n---------\u5904\u7406\u524d------------\n")))),Object(l.b)("h2",{id:"\u62e6\u622a\u5668\u5b9e\u73b0\u767b\u5f55\u5224\u65ad\u9a8c\u8bc1"},"\u62e6\u622a\u5668\u5b9e\u73b0\u767b\u5f55\u5224\u65ad\u9a8c\u8bc1"),Object(l.b)("p",null,"\u5728/WEB-INF\u4e0b\u7684\u6240\u6709\u9875\u9762\u6216\u8005\u8d44\u6e90\u53ea\u80fd\u901a\u8fc7Controller\u6216\u8005Servlet\u8fdb\u884c\u8bbf\u95ee"),Object(l.b)("div",{className:"admonition admonition-info alert alert--info"},Object(l.b)("div",Object(r.a)({parentName:"div"},{className:"admonition-heading"}),Object(l.b)("h5",{parentName:"div"},Object(l.b)("span",Object(r.a)({parentName:"h5"},{className:"admonition-icon"}),Object(l.b)("svg",Object(r.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(l.b)("path",Object(r.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(l.b)("div",Object(r.a)({parentName:"div"},{className:"admonition-content"}),Object(l.b)("p",{parentName:"div"},"\u9700\u6c42\uff1a\u53ea\u6709\u767b\u5f55\u7528\u6237\u624d\u80fd\u8bbf\u95ee\u4e3b\u9875"))),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"\u4e3b\u9875main.jsp"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",Object(r.a)({parentName:"pre"},{className:"language-html"}),'<%--\n  Created by IntelliJ IDEA.\n  User: Cesky001\n  Date: 2020/4/25\n  Time: 14:15\n  To change this template use File | Settings | File Templates.\n--%>\n<%@ page contentType="text/html;charset=UTF-8" language="java" %>\n<html>\n<head>\n    <title>Title</title>\n</head>\n<body>\n\n<h1>\u9996\u9875</h1>\n\n</body>\n</html>\n'))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"\u767b\u5f55\u9875\u9762login.jsp"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",Object(r.a)({parentName:"pre"},{className:"language-html"}),'<%@ page contentType="text/html;charset=UTF-8" language="java" %>\n<html>\n<head>\n    <title>\u767b\u5f55\u9875\u9762</title>\n</head>\n<body>\n\n<h1>\u767b\u9646\u9875\u9762</h1>\n<form action="/login" method="post">\n    \u7528\u6237\u540d\uff1a<input type="text" name="username"/>\n    \u5bc6  \u7801\uff1a<input type="text" name="password"/>\n    <input type="submit" value="\u63d0\u4ea4">\n</form>\n\n</body>\n</html>\n'))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"LoginController"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",Object(r.a)({parentName:"pre"},{className:"language-java"}),'@Controller\npublic class LoginController {\n\n    /***\n     *  \u524d\u5f80\u4e3b\u9875\u7684\u8def\u7531\n     */\n    @RequestMapping("/main")\n    public String main() {\n        return "main";\n    }\n\n    //\u524d\u5f80\u767b\u5f55\u9875\u9762\n    @RequestMapping("/goLogin")\n    public String goLogin(){\n        return "login";\n    }\n\n    @RequestMapping("/login")\n    public String login(HttpServletRequest request) {\n        String username = request.getParameter("username");\n        String password = request.getParameter("password");\n\n        //\u628a\u7528\u6237\u7684\u4fe1\u606f\u5b58\u5728session\u4e2d\n        HttpSession session = request.getSession();\n        session.setAttribute("userLoginInfo", username);\n\n        return "main";\n    }\n}\n'))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"index.jsp\u9875\u9762\u63d0\u4f9b\u5165\u53e3"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",Object(r.a)({parentName:"pre"},{className:"language-html"}),'<%@ page contentType="text/html;charset=UTF-8" language="java" %>\n<html>\n<head>\n    <title>$Title$</title>\n</head>\n<body>\n    <h1><a href="/goLogin">\u767b\u9646\u9875\u9762</a></h1>\n    <h1><a href="/main">\u9996\u9875</a></h1>\n</body>\n</html>\n')))),Object(l.b)("h3",{id:"\u767b\u5f55\u62e6\u622a\u5668"},"\u767b\u5f55\u62e6\u622a\u5668"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"LoginIntercepter"),Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"\u5224\u65ad\u662f\u5426\u767b\u5f55",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"\u662f\u5426\u6709session"))),Object(l.b)("li",{parentName:"ul"},"\u5df2\u767b\u5f55\uff1a\u653e\u884c\n\u672a\u767b\u5f55\uff1a\u91cd\u5b9a\u5411\u5230\u767b\u5f55\u9875\u9762")),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",Object(r.a)({parentName:"pre"},{className:"language-java"}),'public class LoginInterceptor implements HandlerInterceptor {\n    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\n        //\u672c\u8eab\u5c31\u5728\u767b\u5f55\u9875\u9762\uff0c\u653e\u884c\n        if (request.getRequestURI().contains("login")) {\n            return true;\n        }\n        //\u5b58\u5728\u767b\u5f55\u7528\u6237\uff0c\u653e\u884c\n        HttpSession session = request.getSession();\n        String username = (String) session.getAttribute("userLoginInfo");\n        if (username != null && !username.equals("")) {\n            return true;   //\u653e\u884c\n        }\n        //\u5426\u5219\u4e0d\u653e\u884c\uff0c\u8f6c\u53d1\u5230\u767b\u5f55\n        request.getRequestDispatcher("/WEB-INF/jsp/login.jsp").forward(request, response);\n        return false;\n    }\n}\n'))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"\u5728springmvc_servlet.xml\u4e2d\u914d\u7f6e\u62e6\u622a\u5668"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",Object(r.a)({parentName:"pre"},{className:"language-xml"}),'<mvc:interceptor>\n    <mvc:mapping path="/**"/>\n    <bean class="com.bsx.intercepter.LoginInterceptor"/>\n</mvc:interceptor>\n')))),Object(l.b)("p",null,Object(l.b)("strong",{parentName:"p"},"\u8fd9\u6837\u76f4\u63a5\u8bbf\u95ee\u4e3b\u9875\u4f1a\u88ab\u62e6\u622a\uff0c\u91cd\u5b9a\u5411\u5230\u767b\u5f55\u9875\u9762\uff0c\u8981\u6c42\u7528\u6237\u767b\u5f55")),Object(l.b)("p",null,Object(l.b)("strong",{parentName:"p"},"\u540c\u7406\u8fd8\u53ef\u4ee5\u505a\u7528\u6237\u6ce8\u9500")))}o.isMDXComponent=!0},561:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return j}));var r=n(0),a=n.n(r);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var b=a.a.createContext({}),o=function(e){var t=a.a.useContext(b),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},s=function(e){var t=o(e.components);return a.a.createElement(b.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},m=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,i=e.parentName,b=p(e,["components","mdxType","originalType","parentName"]),s=o(n),m=r,j=s["".concat(i,".").concat(m)]||s[m]||u[m]||l;return n?a.a.createElement(j,c(c({ref:t},b),{},{components:n})):a.a.createElement(j,c({ref:t},b))}));function j(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=m;var c={};for(var p in t)hasOwnProperty.call(t,p)&&(c[p]=t[p]);c.originalType=e,c.mdxType="string"==typeof e?e:r,i[1]=c;for(var b=2;b<l;b++)i[b]=n[b];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"}}]);